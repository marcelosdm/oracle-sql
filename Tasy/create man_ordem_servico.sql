
  CREATE TABLE "TASY"."MAN_ORDEM_SERVICO" 
   (	"NR_SEQUENCIA" NUMBER(10,0) NOT NULL ENABLE, 
	"NR_SEQ_LOCALIZACAO" NUMBER(10,0), 
	"NR_SEQ_EQUIPAMENTO" NUMBER(10,0), 
	"CD_PESSOA_SOLICITANTE" VARCHAR2(10 BYTE), 
	"DT_ORDEM_SERVICO" DATE, 
	"IE_PRIORIDADE" VARCHAR2(1 BYTE) NOT NULL ENABLE, 
	"IE_PARADO" VARCHAR2(1 BYTE) NOT NULL ENABLE, 
	"DS_DANO_BREVE" VARCHAR2(80 BYTE) NOT NULL ENABLE, 
	"DT_ATUALIZACAO" DATE NOT NULL ENABLE, 
	"NM_USUARIO" VARCHAR2(15 BYTE) NOT NULL ENABLE, 
	"DT_INICIO_DESEJADO" DATE, 
	"DT_CONCLUSAO_DESEJADA" DATE, 
	"DS_DANO" VARCHAR2(4000 BYTE) NOT NULL ENABLE, 
	"NM_USUARIO_EXEC" VARCHAR2(15 BYTE), 
	"DT_INICIO_PREVISTO" DATE, 
	"DT_FIM_PREVISTO" DATE, 
	"DT_INICIO_REAL" DATE, 
	"DT_FIM_REAL" DATE, 
	"IE_TIPO_ORDEM" NUMBER(5,0) NOT NULL ENABLE, 
	"IE_STATUS_ORDEM" VARCHAR2(1 BYTE), 
	"NR_GRUPO_PLANEJ" NUMBER(10,0), 
	"NR_GRUPO_TRABALHO" NUMBER(10,0), 
	"NR_SEQ_PLANEJ" NUMBER(10,0), 
	"NR_SEQ_TIPO_CONTADOR" NUMBER(10,0), 
	"NR_SEQ_TIPO_SOLUCAO" NUMBER(10,0), 
	"DS_SOLUCAO" VARCHAR2(255 BYTE), 
	"QT_CONTADOR" NUMBER(15,4), 
	"NR_SEQ_ESTAGIO" NUMBER(10,0), 
	"CD_PROJETO" VARCHAR2(20 BYTE), 
	"NR_SEQ_ETAPA_PROJ" NUMBER(10,0), 
	"DT_REABERTURA" DATE, 
	"CD_FUNCAO" NUMBER(5,0), 
	"NM_TABELA" VARCHAR2(50 BYTE), 
	"IE_CLASSIFICACAO" VARCHAR2(1 BYTE), 
	"NR_SEQ_ORIGEM" NUMBER(10,0), 
	"NR_SEQ_PROJETO" NUMBER(10,0), 
	"IE_GRAU_SATISFACAO" VARCHAR2(3 BYTE), 
	"NR_SEQ_INDICADOR" NUMBER(10,0), 
	"NR_SEQ_CAUSA_DANO" NUMBER(10,0), 
	"IE_FORMA_RECEB" VARCHAR2(1 BYTE), 
	"NR_SEQ_CLIENTE" NUMBER(10,0), 
	"NR_SEQ_GRUPO_DES" NUMBER(10,0), 
	"NR_SEQ_GRUPO_SUP" NUMBER(10,0), 
	"NR_SEQ_SUPERIOR" NUMBER(10,0), 
	"IE_EFICACIA" VARCHAR2(1 BYTE), 
	"DT_PREV_EFICACIA" DATE, 
	"CD_PF_EFICACIA" VARCHAR2(10 BYTE), 
	"NR_SEQ_NAO_CONFORM" NUMBER(10,0), 
	"NR_SEQ_COMPLEX" NUMBER(10,0), 
	"DT_ATUALIZACAO_NREC" DATE, 
	"NM_USUARIO_NREC" VARCHAR2(15 BYTE), 
	"IE_OBRIGA_NEWS" VARCHAR2(1 BYTE), 
	"NR_SEQ_META_PE" NUMBER(10,0), 
	"NM_USUARIO_LIB_NEWS" VARCHAR2(15 BYTE), 
	"DT_LIBERA_NEWS" DATE, 
	"NR_SEQ_CLASSIF" NUMBER(10,0), 
	"NR_SEQ_NIVEL_VALOR" NUMBER(10,0), 
	"DT_ENVIO_WHEB" DATE, 
	"DS_CONTATO_SOLICITANTE" VARCHAR2(255 BYTE), 
	"IE_PRIORIDADE_DESEN" NUMBER(3,0), 
	"IE_PRIORIDADE_SUP" NUMBER(3,0), 
	"NR_SEQ_RISCO_IMPL" NUMBER(10,0), 
	"NR_SEQ_MOTIVO_CANCEL_ACAO" NUMBER(10,0), 
	"NR_SEQ_WHEB" NUMBER(10,0), 
	"DT_VALIDACAO_PE" DATE, 
	"NR_SEQ_OBJ_BSC" NUMBER(10,0), 
	"DT_ORDEM_ORIGINAL" DATE, 
	"IE_PRIORIDADE_CLIENTE" VARCHAR2(1 BYTE), 
	"IE_CLASSIFICACAO_CLIENTE" VARCHAR2(1 BYTE), 
	"NR_SEQ_CORRESP" NUMBER(10,0), 
	"NR_SEQ_ETAPA_GPI" NUMBER(10,0), 
	"NR_SEQ_PROJ_GPI" NUMBER(10,0), 
	"NR_SEQ_CLASSIF_GESTAO" NUMBER(10,0), 
	"DT_FIM_ACORDO" DATE, 
	"CD_PF_RESP_BSC" VARCHAR2(10 BYTE), 
	"NM_PESSOA_ACORDO" VARCHAR2(255 BYTE), 
	"DT_INTERNA_ACORDO" DATE, 
	"DT_EXTERNA_ACORDO" DATE, 
	"IE_RESP_TESTE" VARCHAR2(15 BYTE), 
	"NR_SEQ_CS" NUMBER(10,0), 
	"DT_FIM_GARANTIA" DATE, 
	"DS_EVIDENCIA" VARCHAR2(255 BYTE), 
	"NM_USUARIO_PRIORIDADE" VARCHAR2(15 BYTE), 
	"NM_USUARIO_CLASSIF" VARCHAR2(15 BYTE), 
	"NR_SEQ_ORIGEM_DANO" NUMBER(10,0), 
	"DT_ULT_ACESSO_LIDER" DATE, 
	"DT_IMPRESSAO" DATE, 
	"IE_OS_RELATORIO" VARCHAR2(1 BYTE), 
	"QT_DIA_ANALISE_EFICACIA_ACAO" NUMBER(15,0), 
	"IE_TIPO_CUSTOMIZACAO_OS" VARCHAR2(15 BYTE), 
	"NM_USUARIO_ENCER" VARCHAR2(15 BYTE), 
	"NR_SEQ_PROJ_CRON_ETAPA" NUMBER(10,0), 
	"IE_ORIGEM_OS" VARCHAR2(15 BYTE), 
	"NR_SEQ_MODELO" NUMBER(10,0), 
	"NR_SEQ_ATEND_PLS" NUMBER(10,0), 
	"NR_SEQ_EVENTO_ATEND" NUMBER(10,0), 
	"NR_SEQ_TIPO_ORDEM" NUMBER(10,0), 
	"NR_SEQ_TRE_AGENDA" NUMBER(10,0), 
	"DT_ACEITE_OS" DATE, 
	"DS_JUST_RET_NEWS" VARCHAR2(255 BYTE), 
	"IE_EXCLUSIVA" VARCHAR2(15 BYTE), 
	"NR_SEQ_SERVICO" NUMBER(10,0), 
	"CD_SETOR_ATENDIMENTO" NUMBER(5,0), 
	"DS_PALAVRA_CHAVE" VARCHAR2(2000 BYTE), 
	"IE_ENVOLVE_TREINAMENTO" VARCHAR2(1 BYTE), 
	"IE_COMPONENTE" VARCHAR2(15 BYTE), 
	"IE_CUSTOMIZACAO" VARCHAR2(15 BYTE), 
	"NR_SEQ_RISCO_GPI" NUMBER(10,0), 
	"NR_SEQ_JUSTIF_GRAU_SATISF" NUMBER(10,0), 
	"IE_TIPO_OS_QUALIDADE" VARCHAR2(15 BYTE), 
	"NR_SEQ_DOCUMENTO" NUMBER(10,0), 
	"IE_ORIENTACAO_SATISFACAO" VARCHAR2(1 BYTE), 
	"DT_INICIO_DESEJ_CLIENTE" DATE, 
	"DT_FIM_DESEJ_CLIENTE" DATE, 
	"NR_SEQ_MOTIVO_CANCEL" NUMBER(10,0), 
	"IE_TESTE_PERFORMANCE" VARCHAR2(3 BYTE), 
	"NR_SEQ_TIPO_OCOR" NUMBER(10,0), 
	"DT_VERSAO_PREV" DATE, 
	"CD_CLASSIF_ESTRUT" VARCHAR2(20 BYTE), 
	"CD_EMPRESA_REFER" NUMBER(10,0), 
	"DT_LIBERACAO" DATE, 
	"DT_APROVACAO" DATE, 
	"NR_SEQ_CATEGORIA" NUMBER(10,0), 
	"PR_CONCLUSAO_OS" NUMBER(5,2), 
	"DT_INICIO_ANALISE_QUAL_SOFT" DATE, 
	"DT_FIM_ANALISE_QUAL_SOFT" DATE, 
	"NM_USUARIO_ANALISE_QUAL_SOFT" VARCHAR2(15 BYTE), 
	"IE_ATUALIZACAO_MIGRACAO" VARCHAR2(1 BYTE), 
	"NM_USUARIO_ATUAL_MIGR" VARCHAR2(15 BYTE), 
	"DT_ATUALIZACAO_MIGRACAO" DATE, 
	"IE_ESCALA_EMAIL_SUP" VARCHAR2(1 BYTE), 
	"DS_JUSTIF_GRAU_SATISF" VARCHAR2(255 BYTE), 
	"NR_SEQ_REGRA_INCID_BANCO" NUMBER(10,0), 
	"NR_SEQ_GERENCIA_INSATISF" NUMBER(10,0), 
	"DS_MAQUINA_CRIACAO" VARCHAR2(80 BYTE), 
	"NR_SEQ_CONFIDENCIALIDADE" NUMBER(10,0), 
	"NR_SEQ_GRUPO_GERENCIA" NUMBER(10,0), 
	"NR_SEQ_INDICADOR_BSC" NUMBER(10,0), 
	"NR_SEQ_SEVERIDADE" NUMBER(10,0), 
	"NR_SEQ_SEVERIDADE_WHEB" NUMBER(10,0), 
	"IE_REINCIDENTE" VARCHAR2(15 BYTE), 
	"DS_OBSERVACAO" VARCHAR2(4000 BYTE), 
	"NR_SEQ_PLANO_CONT" NUMBER(10,0), 
	"NR_SEQ_CAUSA_RNC" NUMBER(10,0), 
	"IE_RESP_TESTE_REPROG" VARCHAR2(15 BYTE), 
	"DS_ANALISE_INSATISFACAO" VARCHAR2(4000 BYTE), 
	"NR_SEQ_LIB_ATEND_PLS" NUMBER(10,0), 
	"DS_ESTAGIO_PHILIPS" VARCHAR2(255 BYTE), 
	"NM_USUARIO_ASS_INSATISF" VARCHAR2(15 BYTE), 
	"DT_ASSUMIU_INSATISF" DATE, 
	"DT_PREV_PHILIPS" DATE, 
	"CD_CENTRO_CUSTO_OS" NUMBER(8,0), 
	"IE_OBRIGAR_AVALIACAO" VARCHAR2(1 BYTE), 
	"DT_FIM_ANALISE_EFICACIA" DATE, 
	"NR_SEQ_INTEGRACAO" NUMBER(10,0), 
	"NR_SEQ_PEND_CLASSIF_GPW" NUMBER(10,0), 
	"NR_SEQ_APLICACAO_SOFT" NUMBER(10,0), 
	"NR_SEQ_MODULO_APL_SOFT" NUMBER(10,0), 
	"NR_SEQ_FUNC_ITEM" NUMBER(10,0), 
	"IE_EXIGE_AVAL_CLIENTE" VARCHAR2(1 BYTE), 
	"DT_INICIO_REPACTUADO" DATE, 
	"DT_FIM_REPACTUADO" DATE, 
	"NR_SEQ_CTB_ORC" NUMBER(10,0), 
	"NR_VERSAO_CLIENTE_ABERTURA" VARCHAR2(20 BYTE), 
	"IE_INICIATIVA_CANCELADA" VARCHAR2(1 BYTE), 
	"DT_INICIATIVA_CANCELADA" DATE, 
	"NR_SEQ_BO" NUMBER(10,0), 
	"CD_EXTERNO_OS" VARCHAR2(20 BYTE), 
	"NR_SEQ_MOTIVO_REPROG" NUMBER(10,0), 
	"DT_REPROGRAMACAO" DATE, 
	"NM_USUARIO_REPROG" VARCHAR2(15 BYTE), 
	"IE_SOLIC_VIP" VARCHAR2(15 BYTE), 
	"DT_TESTE_NEGOCIO" DATE, 
	"NR_SEQ_ACAO" NUMBER(10,0), 
	"NR_SEQ_MODELO_QUEST_PHILIPS" NUMBER(10,0), 
	"NR_SEQ_COMPLEX_RELAT" NUMBER(10,0), 
	"DT_LIBERACAO_EXEC" DATE, 
	"IE_ORIGEM_NECESSIDADE" VARCHAR2(15 BYTE), 
	"IE_TIPO_NECESSIDADE" VARCHAR2(15 BYTE), 
	"IE_AVAL_EFIC" VARCHAR2(1 BYTE), 
	"NR_SEQ_MOTIVO_EFICACIA_ACAO" NUMBER(10,0), 
	"DS_ALT_COMPLEX" VARCHAR2(255 BYTE), 
	"IE_ORIGEM_PCS" VARCHAR2(1 BYTE), 
	"NR_SEQ_MOTIVO_PCS" NUMBER(10,0), 
	"NR_SEQ_ATIVIDADE" NUMBER(10,0), 
	"NR_SEQ_REGIONAL" NUMBER(10,0), 
	"NR_SEQ_GRUPAMENTO" NUMBER(10,0), 
	"NR_SEQ_GRUPO_TESTE" NUMBER(10,0), 
	"NR_SEQ_REGRA_ATIV" NUMBER(10,0), 
	"NR_SEQ_COMPLEX_CUSTOM" NUMBER(10,0), 
	"NR_SEQ_TIPO_PROJ" NUMBER(10,0), 
	"NR_SEQ_LISTA" NUMBER(10,0), 
	"IE_SUPORTE_REMOTO" VARCHAR2(2 BYTE), 
	"CD_VERSAO_ENTREGA" VARCHAR2(20 BYTE), 
	"NR_SEQ_CLASSIF_NAO_CONFORM" NUMBER(10,0), 
	"DS_JUST_MIGR_NEG" VARCHAR2(255 BYTE), 
	"NM_USUARIO_MIGR_NEG" VARCHAR2(15 BYTE), 
	"DT_MIGR_NEG" DATE, 
	"IE_PLATAFORMA" VARCHAR2(1 BYTE), 
	"IE_AMBIENTE" VARCHAR2(1 BYTE), 
	"IE_GERADO_PROJETO" VARCHAR2(1 BYTE), 
	"IE_LOCALIZACAO_24H" VARCHAR2(3 BYTE), 
	"QT_PRIORIDADE" NUMBER(3,0), 
	"DS_JUST_SEVERIDADE" VARCHAR2(255 BYTE), 
	"DT_CONCLUSAO_NC_ACAO_AREA" DATE, 
	 CONSTRAINT "MANORSE_PK" PRIMARY KEY ("NR_SEQUENCIA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX"  ENABLE, 
	 CONSTRAINT "MANORSE_APLICSO_FK" FOREIGN KEY ("NR_SEQ_APLICACAO_SOFT")
	  REFERENCES "TASY"."APLICACAO_SOFTWARE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_APLSMOD_FK" FOREIGN KEY ("NR_SEQ_MODULO_APL_SOFT")
	  REFERENCES "TASY"."APLICACAO_SOFT_MODULO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_FUNITEM_FK" FOREIGN KEY ("NR_SEQ_FUNC_ITEM")
	  REFERENCES "TASY"."FUNCAO_ITEM" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_CTBORCA_FK" FOREIGN KEY ("NR_SEQ_CTB_ORC")
	  REFERENCES "TASY"."CTB_ORCAMENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_SACBOOC_FK" FOREIGN KEY ("NR_SEQ_BO")
	  REFERENCES "TASY"."SAC_BOLETIM_OCORRENCIA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANMROS_FK" FOREIGN KEY ("NR_SEQ_MOTIVO_REPROG")
	  REFERENCES "TASY"."MAN_MOTIVO_REPROG_OS" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_DESCORE_FK" FOREIGN KEY ("NR_SEQ_COMPLEX_RELAT")
	  REFERENCES "TASY"."DES_COMPLEXIDADE_RELAT" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_QUAMEAC_FK" FOREIGN KEY ("NR_SEQ_MOTIVO_EFICACIA_ACAO")
	  REFERENCES "TASY"."QUA_MOTIVO_EFICACIA_ACAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PCSATVD_FK" FOREIGN KEY ("NR_SEQ_ATIVIDADE")
	  REFERENCES "TASY"."PCS_ATIVIDADES" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PCSGRUP_FK" FOREIGN KEY ("NR_SEQ_GRUPAMENTO")
	  REFERENCES "TASY"."PCS_GRUPAMENTOS" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PCSMOTI_FK" FOREIGN KEY ("NR_SEQ_MOTIVO_PCS")
	  REFERENCES "TASY"."PCS_MOTIVOS" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PCSREGI_FK" FOREIGN KEY ("NR_SEQ_REGIONAL")
	  REFERENCES "TASY"."PCS_REGIONAIS" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_DESCCUS_FK" FOREIGN KEY ("NR_SEQ_COMPLEX_CUSTOM")
	  REFERENCES "TASY"."DES_COMPLEXIDADE_CUSTOM" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GRUTES_FK" FOREIGN KEY ("NR_SEQ_GRUPO_TESTE")
	  REFERENCES "TASY"."GRUPO_TESTE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PCSREAT_FK" FOREIGN KEY ("NR_SEQ_REGRA_ATIV")
	  REFERENCES "TASY"."PCS_REGRA_ATIVIDADES" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GPWPECL_FK" FOREIGN KEY ("NR_SEQ_PEND_CLASSIF_GPW")
	  REFERENCES "TASY"."GPW_PENDENCIA_CLASSIF" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_INTINTEGRA_FK" FOREIGN KEY ("NR_SEQ_INTEGRACAO")
	  REFERENCES "TASY"."INT_INTEGRACAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_ETAPROJ_FK" FOREIGN KEY ("NR_SEQ_ETAPA_PROJ")
	  REFERENCES "TASY"."ETAPA_PROJETO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PROJRIIM_FK" FOREIGN KEY ("NR_SEQ_RISCO_IMPL")
	  REFERENCES "TASY"."PROJ_RISCO_IMPLANTACAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANMCOS_FK" FOREIGN KEY ("NR_SEQ_MOTIVO_CANCEL")
	  REFERENCES "TASY"."MAN_MOTIVO_CANCEL_OS" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_EMPREFE_FK" FOREIGN KEY ("CD_EMPRESA_REFER")
	  REFERENCES "TASY"."EMPRESA_REFERENCIA" ("CD_EMPRESA") ENABLE, 
	 CONSTRAINT "MANORSE_MANTCOS_FK" FOREIGN KEY ("NR_SEQ_CATEGORIA")
	  REFERENCES "TASY"."MAN_TIPO_CATEGORIA_OS" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GERWHEB_FK" FOREIGN KEY ("NR_SEQ_GERENCIA_INSATISF")
	  REFERENCES "TASY"."GERENCIA_WHEB" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANROIB_FK" FOREIGN KEY ("NR_SEQ_REGRA_INCID_BANCO")
	  REFERENCES "TASY"."MAN_REGRA_OS_INCID_BANCO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANCONF_FK" FOREIGN KEY ("NR_SEQ_CONFIDENCIALIDADE")
	  REFERENCES "TASY"."MAN_CONFIDENCIALIDADE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_BSCINDI_FK" FOREIGN KEY ("NR_SEQ_INDICADOR_BSC")
	  REFERENCES "TASY"."BSC_INDICADOR" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GERWHGR_FK" FOREIGN KEY ("NR_SEQ_GRUPO_GERENCIA")
	  REFERENCES "TASY"."GERENCIA_WHEB_GRUPO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANSEVE_FK" FOREIGN KEY ("NR_SEQ_SEVERIDADE")
	  REFERENCES "TASY"."MAN_SEVERIDADE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANSEVE_FK2" FOREIGN KEY ("NR_SEQ_SEVERIDADE_WHEB")
	  REFERENCES "TASY"."MAN_SEVERIDADE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANPCON_FK" FOREIGN KEY ("NR_SEQ_PLANO_CONT")
	  REFERENCES "TASY"."MAN_PLANO_CONTINGENCIA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_QUANACC_FK" FOREIGN KEY ("NR_SEQ_CAUSA_RNC")
	  REFERENCES "TASY"."QUA_NAO_CONFORM_CAUSA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PLSRLRW_FK" FOREIGN KEY ("NR_SEQ_LIB_ATEND_PLS")
	  REFERENCES "TASY"."PLS_REGRA_LIB_REQ_WEB" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_CENCUST_FK" FOREIGN KEY ("CD_CENTRO_CUSTO_OS")
	  REFERENCES "TASY"."CENTRO_CUSTO" ("CD_CENTRO_CUSTO") ENABLE, 
	 CONSTRAINT "MANORSE_COMCLIE_FK" FOREIGN KEY ("NR_SEQ_CLIENTE")
	  REFERENCES "TASY"."COM_CLIENTE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GRUDESE_FK" FOREIGN KEY ("NR_SEQ_GRUPO_DES")
	  REFERENCES "TASY"."GRUPO_DESENVOLVIMENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GRUSUPO_FK" FOREIGN KEY ("NR_SEQ_GRUPO_SUP")
	  REFERENCES "TASY"."GRUPO_SUPORTE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_INDEVOL_FK" FOREIGN KEY ("NR_SEQ_INDICADOR")
	  REFERENCES "TASY"."INDICADOR_GESTAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MAESTPR_FK" FOREIGN KEY ("NR_SEQ_ESTAGIO")
	  REFERENCES "TASY"."MAN_ESTAGIO_PROCESSO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANCADA_FK" FOREIGN KEY ("NR_SEQ_CAUSA_DANO")
	  REFERENCES "TASY"."MAN_CAUSA_DANO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANCOMP_FK" FOREIGN KEY ("NR_SEQ_COMPLEX")
	  REFERENCES "TASY"."MAN_COMPLEXIDADE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANEQUI_FK" FOREIGN KEY ("NR_SEQ_EQUIPAMENTO")
	  REFERENCES "TASY"."MAN_EQUIPAMENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANGRPL_FK" FOREIGN KEY ("NR_GRUPO_PLANEJ")
	  REFERENCES "TASY"."MAN_GRUPO_PLANEJAMENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANGRTR_FK" FOREIGN KEY ("NR_GRUPO_TRABALHO")
	  REFERENCES "TASY"."MAN_GRUPO_TRABALHO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANLOCA_FK" FOREIGN KEY ("NR_SEQ_LOCALIZACAO")
	  REFERENCES "TASY"."MAN_LOCALIZACAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANPLPR_FK" FOREIGN KEY ("NR_SEQ_PLANEJ")
	  REFERENCES "TASY"."MAN_PLANEJ_PREV" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANTICO_FK" FOREIGN KEY ("NR_SEQ_TIPO_CONTADOR")
	  REFERENCES "TASY"."MAN_TIPO_CONTADOR" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANTISO_FK" FOREIGN KEY ("NR_SEQ_TIPO_SOLUCAO")
	  REFERENCES "TASY"."MAN_TIPO_SOLUCAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PESFISI_FK" FOREIGN KEY ("CD_PESSOA_SOLICITANTE")
	  REFERENCES "TASY"."PESSOA_FISICA" ("CD_PESSOA_FISICA") ENABLE, 
	 CONSTRAINT "MANORSE_PESFISI_FK4" FOREIGN KEY ("CD_PF_EFICACIA")
	  REFERENCES "TASY"."PESSOA_FISICA" ("CD_PESSOA_FISICA") ENABLE, 
	 CONSTRAINT "MANORSE_PROTASY_FK" FOREIGN KEY ("NR_SEQ_PROJETO")
	  REFERENCES "TASY"."PROJETO_TASY" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_QUANACO_FK" FOREIGN KEY ("NR_SEQ_NAO_CONFORM")
	  REFERENCES "TASY"."QUA_NAO_CONFORMIDADE" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PLEMETA_FK" FOREIGN KEY ("NR_SEQ_META_PE")
	  REFERENCES "TASY"."PLE_META" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANCLAS_FK" FOREIGN KEY ("NR_SEQ_CLASSIF")
	  REFERENCES "TASY"."MAN_CLASSIFICACAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANNIVA_FK" FOREIGN KEY ("NR_SEQ_NIVEL_VALOR")
	  REFERENCES "TASY"."MAN_NIVEL_VALOR" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PLEMOCA_FK" FOREIGN KEY ("NR_SEQ_MOTIVO_CANCEL_ACAO")
	  REFERENCES "TASY"."PLE_MOTIVO_CANC_ACAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PLEOBJE_FK" FOREIGN KEY ("NR_SEQ_OBJ_BSC")
	  REFERENCES "TASY"."PLE_OBJETIVO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GPICRETA_FK" FOREIGN KEY ("NR_SEQ_ETAPA_GPI")
	  REFERENCES "TASY"."GPI_CRON_ETAPA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_GPIPROJ_FK" FOREIGN KEY ("NR_SEQ_PROJ_GPI")
	  REFERENCES "TASY"."GPI_PROJETO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANCLGE_FK" FOREIGN KEY ("NR_SEQ_CLASSIF_GESTAO")
	  REFERENCES "TASY"."MAN_CLASSIF_GESTAO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PESFISI_FK5" FOREIGN KEY ("CD_PF_RESP_BSC")
	  REFERENCES "TASY"."PESSOA_FISICA" ("CD_PESSOA_FISICA") ENABLE, 
	 CONSTRAINT "MANORSE_MACATSE_FK" FOREIGN KEY ("NR_SEQ_CS")
	  REFERENCES "TASY"."MAN_CATALOGO_SERVICO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANORDA_FK" FOREIGN KEY ("NR_SEQ_ORIGEM_DANO")
	  REFERENCES "TASY"."MAN_ORIGEM_DANO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PROCRET_FK" FOREIGN KEY ("NR_SEQ_PROJ_CRON_ETAPA")
	  REFERENCES "TASY"."PROJ_CRON_ETAPA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PLSATEN_FK" FOREIGN KEY ("NR_SEQ_ATEND_PLS")
	  REFERENCES "TASY"."PLS_ATENDIMENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MODELOT_FK" FOREIGN KEY ("NR_SEQ_MODELO")
	  REFERENCES "TASY"."MODELO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PLSASEV_FK" FOREIGN KEY ("NR_SEQ_EVENTO_ATEND")
	  REFERENCES "TASY"."PLS_ATENDIMENTO_EVENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANTIOS_FK" FOREIGN KEY ("NR_SEQ_TIPO_ORDEM")
	  REFERENCES "TASY"."MAN_TIPO_ORDEM_SERVICO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_TREAGEN_FK" FOREIGN KEY ("NR_SEQ_TRE_AGENDA")
	  REFERENCES "TASY"."TRE_AGENDA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_SERVICO_FK" FOREIGN KEY ("NR_SEQ_SERVICO")
	  REFERENCES "TASY"."SERVICO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_SETATEN_FK" FOREIGN KEY ("CD_SETOR_ATENDIMENTO")
	  REFERENCES "TASY"."SETOR_ATENDIMENTO" ("CD_SETOR_ATENDIMENTO") ENABLE, 
	 CONSTRAINT "MANORSE_GPIRIPRJ_FK" FOREIGN KEY ("NR_SEQ_RISCO_GPI")
	  REFERENCES "TASY"."GPI_RISCO_PROJETO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANGSJU_FK" FOREIGN KEY ("NR_SEQ_JUSTIF_GRAU_SATISF")
	  REFERENCES "TASY"."MAN_GRAU_SATISF_JUSTIF" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_QUADOCU_FK" FOREIGN KEY ("NR_SEQ_DOCUMENTO")
	  REFERENCES "TASY"."QUA_DOCUMENTO" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_MANTIOC_FK" FOREIGN KEY ("NR_SEQ_TIPO_OCOR")
	  REFERENCES "TASY"."MAN_TIPO_OCORRENCIA" ("NR_SEQUENCIA") ENABLE, 
	 CONSTRAINT "MANORSE_PCSLIST_FK" FOREIGN KEY ("NR_SEQ_LISTA")
	  REFERENCES "TASY"."PCS_LISTAS" ("NR_SEQUENCIA") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_DATA" ;

  CREATE INDEX "TASY"."MANORSE_APLICSO_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_APLICACAO_SOFT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_APLSMOD_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MODULO_APL_SOFT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_BSCINDI_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_INDICADOR_BSC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_CENCUST_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_CENTRO_CUSTO_OS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_COMCLIE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CLIENTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_CTBORCA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CTB_ORC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_DESCCUS_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_COMPLEX_CUSTOM") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_DESCORE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_COMPLEX_RELAT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_EMPREFE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_EMPRESA_REFER") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_ETAPROJ_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ETAPA_PROJ") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_FUNITEM_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_FUNC_ITEM") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GERWHEB_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_GERENCIA_INSATISF") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GERWHGR_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_GRUPO_GERENCIA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GPICRETA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ETAPA_GPI") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GPIPROJ_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_PROJ_GPI") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GPIRIPRJ_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_RISCO_GPI") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GPWPECL_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_PEND_CLASSIF_GPW") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GRUDESE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_GRUPO_DES") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GRUSUPO_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_GRUPO_SUP") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_GRUTES_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_GRUPO_TESTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I1" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ORIGEM", "NR_SEQUENCIA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I2" ON "TASY"."MAN_ORDEM_SERVICO" ("IE_STATUS_ORDEM", "NR_SEQUENCIA", "NR_GRUPO_TRABALHO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I3" ON "TASY"."MAN_ORDEM_SERVICO" ("DT_ORDEM_SERVICO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I4" ON "TASY"."MAN_ORDEM_SERVICO" ("DT_REABERTURA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I5" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_FUNCAO", "NR_SEQ_GRUPO_DES") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I6" ON "TASY"."MAN_ORDEM_SERVICO" ("NM_USUARIO_EXEC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I7" ON "TASY"."MAN_ORDEM_SERVICO" ("DT_FIM_REAL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I8" ON "TASY"."MAN_ORDEM_SERVICO" ("IE_CLASSIFICACAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_I9" ON "TASY"."MAN_ORDEM_SERVICO" (TRUNC("DT_ORDEM_SERVICO")) 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_INDEVOL_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_INDICADOR") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_INTINTEGRA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_INTEGRACAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 499712 NEXT 57344 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MACATSE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MAESTPR_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ESTAGIO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANCADA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CAUSA_DANO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANCLAS_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CLASSIF") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANCLGE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CLASSIF_GESTAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANCOMP_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_COMPLEX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANCONF_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CONFIDENCIALIDADE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANEQUI_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_EQUIPAMENTO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANGRPL_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_GRUPO_PLANEJ") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANGRTR_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_GRUPO_TRABALHO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANGSJU_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_JUSTIF_GRAU_SATISF") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANLOCA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_LOCALIZACAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANMCOS_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MOTIVO_CANCEL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANMROS_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MOTIVO_REPROG") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANNIVA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_NIVEL_VALOR") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANORDA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ORIGEM_DANO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANPCON_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_PLANO_CONT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANPLPR_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_PLANEJ") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANROIB_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_REGRA_INCID_BANCO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANSEVE_FK2_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_SEVERIDADE_WHEB") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANSEVE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_SEVERIDADE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANTCOS_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CATEGORIA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANTICO_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_TIPO_CONTADOR") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANTIOC_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_TIPO_OCOR") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANTIOS_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_TIPO_ORDEM") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MANTISO_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_TIPO_SOLUCAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_MODELOT_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MODELO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PCSATVD_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ATIVIDADE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PCSGRUP_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_GRUPAMENTO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PCSLIST_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_LISTA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PCSMOTI_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MOTIVO_PCS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PCSREAT_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_REGRA_ATIV") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PCSREGI_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_REGIONAL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PESFISI_FK4_I" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_PF_EFICACIA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PESFISI_FK5_I" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_PF_RESP_BSC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PESFISI_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_PESSOA_SOLICITANTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PLEMETA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_META_PE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PLEMOCA_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MOTIVO_CANCEL_ACAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PLEOBJE_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_OBJ_BSC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PLSASEV_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_EVENTO_ATEND") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PLSATEN_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_ATEND_PLS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PLSRLRW_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_LIB_ATEND_PLS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PROCRET_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_PROJ_CRON_ETAPA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PROJRIIM_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_RISCO_IMPL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_PROTASY_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_PROJETO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_QUADOCU_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_DOCUMENTO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_QUAMEAC_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_MOTIVO_EFICACIA_ACAO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_QUANACC_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_CAUSA_RNC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_QUANACO_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_NAO_CONFORM") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_SACBOOC_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_BO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 16384 NEXT 8192 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_SERVICO_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_SERVICO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_SETATEN_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("CD_SETOR_ATENDIMENTO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE INDEX "TASY"."MANORSE_TREAGEN_FK_I" ON "TASY"."MAN_ORDEM_SERVICO" ("NR_SEQ_TRE_AGENDA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TASY_INDEX" ;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_UPDATE" 
BEFORE UPDATE ON man_ordem_servico
FOR EACH ROW
DECLARE
nm_user_w			Varchar2(50);
qt_doc_erro_w			Number(10);
qt_existe_orc_w			number(10,0);
qt_reg_w				number(10);
ie_gerar_grupo_des_w		varchar2(01) := 'S';
NR_SEQ_GERENCIA_W		number(10,0);
nm_usuario_lider_sup_w		varchar2(15);
ie_desenv_w             		varchar2(01) := 'S';
nr_seq_plano_w      	    	number(10,0);
nr_seq_meta_os_w 	       		number(10,0);
ie_tipo_os_meta_w			varchar2(03);
dt_geracao_meta_w		date;

nr_seq_proj_vinc_w			number(10,0);
nr_seq_proj_orig_w			number(10,0);
nr_seq_proj_acomp_w		number(10,0);
ie_produto_w			varchar2(15);
cd_setor_usuario_w			number(05,0) := wheb_usuario_pck.get_cd_setor_atendimento;
qt_ativ_programacao_w		number(10,0);
qt_hist_code_review_w		number(10,0);

BEGIN
ie_gerar_grupo_des_w	:= nvl(Obter_Valor_Param_Usuario(299,228,Obter_Perfil_Ativo,:new.nm_usuario,0),'S');

if	(wheb_usuario_pck.get_ie_executar_trigger	= 'N')  then
	goto Final;
end if;
select	username
into	nm_user_w
from	user_users;

if	(:new.ie_classificacao <> :old.ie_classificacao) then
	:new.nm_usuario_classif	:= :new.nm_usuario;
end if;

if	(:new.ie_prioridade <> :old.ie_prioridade) then
	:new.nm_usuario_prioridade	:= :new.nm_usuario;
end if;

if	(nm_user_w = 'CORP') and
	(:new.ie_classificacao = 'E') and
	(:new.nr_seq_meta_pe is null) and
	(:new.nr_seq_estagio in (2,9,791,1511)) then
	select	count(*)
	into	qt_doc_erro_w
	from	man_doc_erro
	where	nr_seq_ordem	= :new.nr_sequencia
	and	dt_liberacao is not null;

	if	(qt_doc_erro_w = 0) then
		wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173237);
	end if;
end if;

if	(:new.nr_seq_grupo_des is null) and
	(:new.cd_funcao is not null) and
	(ie_gerar_grupo_des_w = 'S') then
	if	(nm_user_w = 'CORP') then
		select	max(ie_produto)
		into	ie_produto_w
		from	com_cliente
		where nr_sequencia = :new.NR_SEQ_CLIENTE;

		select	min(b.nr_sequencia)
		into	:new.nr_seq_grupo_des
		from	grupo_desenvolvimento b,
			funcao_grupo_des a,
			funcao_grupo_des_cli c
		where	a.nr_seq_grupo	= b.nr_sequencia
		AND	a.nr_sequencia = c.nr_seq_funcao_grupo
		and	b.ie_situacao	= 'A'
		and	a.cd_funcao	= :new.cd_funcao
		and	c.nr_seq_localizacao = :new.nr_seq_localizacao
		and 	((ie_produto_w='P' and b.nr_sequencia <> 45) or (ie_produto_w='O' and b.nr_sequencia <> 4) or (ie_produto_w is null));

		if	(:new.nr_seq_grupo_des is null) then
			select	min(b.nr_sequencia)
			into	:new.nr_seq_grupo_des
			from	grupo_desenvolvimento b,
				funcao_grupo_des a
			where	a.nr_seq_grupo	= b.nr_sequencia
			and	b.ie_situacao	= 'A'
			and	a.cd_funcao	= :new.cd_funcao
			and 	((ie_produto_w='P' and b.nr_sequencia <> 45) or (ie_produto_w='O' and b.nr_sequencia <> 4) or (ie_produto_w is null))
			and	not exists (select 1
					from	funcao_grupo_des_cli x
					where	a.nr_sequencia = x.nr_seq_funcao_grupo);
		end if;

	end if;

	if	(:new.nr_seq_grupo_des is null) then
		select	min(b.nr_sequencia)
		into	:new.nr_seq_grupo_des
		from	grupo_desenvolvimento b,
			funcao_grupo_des a,
			funcao_grupo_des_cli c
		where	a.nr_seq_grupo	= b.nr_sequencia
		AND	a.nr_sequencia = c.nr_seq_funcao_grupo
		and	b.ie_situacao	= 'A'
		and	a.cd_funcao	= :new.cd_funcao
		and	c.nr_seq_localizacao = :new.nr_seq_localizacao;
	end if;

	if	(:new.nr_seq_grupo_des is null) then
		select	min(b.nr_sequencia)
		into	:new.nr_seq_grupo_des
		from	grupo_desenvolvimento b,
			funcao_grupo_des a
		where	a.nr_seq_grupo	= b.nr_sequencia
		and	b.ie_situacao	= 'A'
		and	a.cd_funcao	= :new.cd_funcao
		and	not exists (select 1
			from	funcao_grupo_des_cli x
			where	a.nr_sequencia = x.nr_seq_funcao_grupo);
	end if;

end if;

if	(:new.nr_seq_grupo_sup is null) and
	(:new.cd_funcao is not null) then
	select	min(b.nr_sequencia)
	into	:new.nr_seq_grupo_sup
	from	grupo_suporte b,
		funcao_grupo_sup a
	where	a.nr_seq_grupo	= b.nr_sequencia
	and	a.cd_funcao	= :new.cd_funcao;

	if	(:new.nr_seq_grupo_sup is not null) then
		select	max(a.nm_usuario_lider)
		into	nm_usuario_lider_sup_w
		from	grupo_suporte a
		where	a.nr_sequencia = :new.nr_seq_grupo_sup;
	end if;
end if;

if	(nm_user_w = 'CORP') then
	begin

	if	(nvl(:old.ie_grau_satisfacao,'XX') <> nvl(:new.ie_grau_satisfacao,'XX')) and
		(:new.ie_grau_satisfacao is not null) and
		(:new.ie_status_ordem = '3') and
		(:NEW.NR_SEQ_ESTAGIO	not in (9)) and --Se j estiver encerrada, no alterar o estgio para Encerramento solicitado pelo cliente
		(:new.dt_fim_real is not null) then
		:new.dt_fim_real	:= null;
		:new.ie_status_ordem	:= '2';
		:NEW.NR_SEQ_ESTAGIO	:= 511;
	end if;

	if	(:new.nr_seq_estagio <> :old.nr_seq_estagio) then
		begin

		select	max(ie_desenv)
		into	ie_desenv_w
		from	man_estagio_processo
		where	nr_sequencia    = :new.nr_seq_estagio;

		select	substr(proj_obter_dados_ordem_serv(:new.nr_sequencia, 'PROJ'),1,10) nr_seq_proj_vinc,
			substr(proj_obter_dados_ordem_serv(:new.nr_sequencia, 'PROJD'),1,10) nr_seq_proj_orig,
			substr(proj_obter_dados_ordem_serv(:new.nr_sequencia, 'PROJA'),1,10) nr_seq_proj_acomp
		into	nr_seq_proj_vinc_w,
			nr_seq_proj_orig_w,
			nr_seq_proj_acomp_w
		from	dual;

		if	(ie_desenv_w = 'S') and
			(nvl(nr_seq_proj_vinc_w,'0') = '0') and
			(nvl(nr_seq_proj_orig_w,'0') = '0') and
			(nvl(nr_seq_proj_acomp_w,'0') = '0') then

			select  max(nr_seq_gerencia)
			into    nr_seq_gerencia_w
			from    grupo_desenvolvimento
			where   nr_sequencia            = :new.nr_seq_grupo_des;

			select  nvl(max(nr_sequencia),0)
			into    nr_seq_plano_w
			from    desenvolvimento_plano_meta
			where   nr_seq_gerencia         = nr_seq_gerencia_w
			and     dt_meta_real is null;

			select	max(dt_geracao)
			into	dt_geracao_meta_w
			from	desenvolvimento_plano_meta
			where	nr_sequencia	= nr_seq_plano_w;

			if	(nr_seq_plano_w > 0) and
				(dt_geracao_meta_w >= :new.dt_ordem_servico) then
				select  count(*)
				into    qt_reg_w
				from    desenv_plano_meta_os
				where   nr_seq_plano            = nr_seq_plano_w
				and	NR_SEQ_ORDEM_SERV       = :new.nr_sequencia;

				if	(qt_reg_w = 0) then
					select  desenv_plano_meta_os_seq.nextval
					into    nr_seq_meta_os_w
					from    dual;

					if	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), to_date('01/01/2007','dd/mm/yyyy'), sysdate -60) = 'S') then
						ie_tipo_os_meta_w	:= '0';
					elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 59, sysdate -45) = 'S') then
						ie_tipo_os_meta_w	:= '1';
					elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 44, sysdate -30) = 'S') then
						ie_tipo_os_meta_w	:= '2';
					elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 29, sysdate -15) = 'S') then
						ie_tipo_os_meta_w	:= '3';
					elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 14, sysdate -7) = 'S') then
						ie_tipo_os_meta_w	:= '4';
					elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 6, sysdate) = 'S') then
						ie_tipo_os_meta_w	:= '5';
					end if;

					if	(ie_tipo_os_meta_w is not null) then
						insert  into desenv_plano_meta_os
								(nr_sequencia,
								nr_seq_plano,
								nr_seq_ordem_serv,
								dt_atualizacao,
								nm_usuario,
								dt_atualizacao_nrec,
								nm_usuario_nrec,
								ie_tipo_os_meta,
								nr_seq_estagio_orig,
								nr_seq_estagio_meta,
								ie_recorrente)
						values		(nr_seq_meta_os_w,
								nr_seq_plano_w,
								:new.nr_sequencia,
								sysdate,
								:new.nm_usuario,
								sysdate,
								:new.nm_usuario,
								ie_tipo_os_meta_w,
								:new.nr_seq_estagio,
								null, 'S');
					end if;
				end if;
			end if;
		end if;
		end;
	end if;

	/*if 	(:new.nr_seq_estagio = 231 ) and --Aguardando Triagem	OS968691
		(:new.ie_classificacao in ('T','S')) then --Solicitao / Sugesto
		begin
		select	max(nr_seq_gerencia)
		into	nr_seq_gerencia_w
		from	grupo_desenvolvimento
		where	nr_sequencia	= :new.nr_seq_grupo_des;

		if	(nr_seq_gerencia_w in (2,3,4,7,11,17,20,21)) then
			:new.nr_seq_estagio	:= 1051; --Aguardando triagem desenvolvimento

			if	(nr_seq_gerencia_w = 2) then
				:new.nr_seq_estagio := 131;
			end if;
		end if;
		end;
	end if;*/

	if 	(:new.nr_seq_estagio = 231) and /* Aguardando Triagem*/
		(nvl(nm_usuario_lider_sup_w,'X') <> 'X') then
		begin
		select	count(*)
		into	qt_reg_w
		from	man_ordem_servico_exec
		where	nm_usuario_exec	= nm_usuario_lider_sup_w
		and	nr_seq_ordem	= :new.nr_sequencia;

		if	(qt_reg_w = 0) then
			insert into man_ordem_servico_exec(
				nr_sequencia,
				nr_seq_ordem,
				dt_atualizacao,
				nm_usuario,
				nm_usuario_exec,
				qt_min_prev,
				dt_recebimento,
				nr_seq_funcao)
			select	man_ordem_servico_exec_seq.nextval,
				:new.nr_sequencia,
				sysdate,
				'Tasy',
				nm_usuario_lider_sup_w,
				45,
				sysdate,
				31
			from	dual;
		end if;

		if	(:new.nm_usuario_exec is null) then
			:new.nm_usuario_exec := nm_usuario_lider_sup_w;
		end if;
		end;
	end if;

	if	(:new.ie_classificacao = 'E') and
		(:new.ie_prioridade_sup is null) then /*Anderson  OS223881 - Conforme IT suporte*/
		:new.ie_prioridade_sup := 10;
	end if;

	/*if	(:new.nr_seq_estagio <> :old.nr_seq_estagio) and
		(:new.nr_seq_estagio = 511) and -- Encerramento solicitado pelo cliente
		(:new.ie_classificacao in ('T','S')) and --Solicitao / Sugesto
		(nvl(:new.ie_grau_satisfacao,'N') in ('O','B','E','N')) and
		(:new.nr_seq_tipo_solucao is not null) then
		begin
		select	count(*)
		into	qt_existe_orc_w
		from	man_ordem_servico_orc
		where	nr_seq_ordem = :new.nr_sequencia
		and	dt_aprovacao is null
		and	dt_reprovacao is null;

		if	(qt_existe_orc_w = 0) then
			:new.dt_inicio_real	:= :new.dt_inicio_previsto;
			:new.dt_fim_real	:= sysdate;
			:new.nr_seq_estagio	:= 9;
			:new.ie_status_ordem	:= 3;
			:new.nm_usuario		:= 'WebService';
			:new.dt_atualizacao	:= sysdate;
			:new.nm_usuario_encer	:= 'WebService';
		end if;
		end;
	end if;*/ -- 972316

	end;
end if;

if	(:old.nr_seq_meta_pe is not null) and
	(:old.ie_status_ordem = 3) and
	(:old.ie_status_ordem <> :new.ie_status_ordem) then
	:new.dt_validacao_pe := '';
end if;

if	(nm_user_w = 'CORP') and
	(:new.ie_status_ordem = 3) and
	(:old.ie_status_ordem <> :new.ie_status_ordem) and
	(upper(:new.nm_usuario) <> 'WEBSERVICE') then

	/*Verifica se existe atividade de programao para esta OS*/
	select	count(1)
	into	qt_ativ_programacao_w
	from	man_ordem_serv_ativ
	where	nr_seq_funcao in (1288,11,551)
	and		nr_seq_ordem_serv = :new.nr_sequencia;

	if	(qt_ativ_programacao_w > 0)then

	/*Verifica se existe histrico do tipo Code Review*/
		select	count(1)
		into 	qt_hist_code_review_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 163
		and		nr_seq_ordem_serv = :new.nr_sequencia;
	end if;

	if (:new.dt_ordem_servico > to_date('11/05/2016', 'dd/mm/yyyy')) then --Somente ir pedir aprovao de code review se a OS foi criada DEPOIS que foi implementado essa rotina de Code Review (11/05/2016) . Mais detalhes verificar OS: 1402146
		if	(qt_hist_code_review_w = 0) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(458500); /*Ateno! Para cada atividade de programao deve existir um histrico de "Aprovao de Code Review"*/
		end if;
	end if;
end if;

if	(nm_user_w = 'CORP') and
	(:new.ie_status_ordem = 3) and
	(:old.ie_status_ordem <> :new.ie_status_ordem) and
	(upper(:new.nm_usuario) <> 'WEBSERVICE') then

	/*Verifica se existe atividade de programao para esta OS*/
	select	count(1)
	into	qt_ativ_programacao_w
	from	man_ordem_serv_ativ
	where	nr_seq_funcao in (1288,11,551)
	and		nr_seq_ordem_serv = :new.nr_sequencia;

	if	(qt_ativ_programacao_w > 0)then

	/*Verifica se existe histrico do tipo "Teste do programador" */
		select	count(1)
		into 	qt_hist_code_review_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 12
		and		nr_seq_ordem_serv = :new.nr_sequencia;

		if	(qt_hist_code_review_w = 0) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(798715); /* obrigatrio o registro de ao menos um histrico do tipo "Teste do programador" para encerrar esta OS! */
		end if;

		/*Verifica se existe histrico do tipo "Teste do analista" */
		select	count(1)
		into 	qt_hist_code_review_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 31
		and		nr_seq_ordem_serv = :new.nr_sequencia;

		if	(qt_hist_code_review_w = 0) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(798729); /* obrigatrio o registro de ao menos um histrico do tipo "Teste do analista" para encerrar esta OS!*/
		end if;
	end if;
end if;


<<Final>>
qt_reg_w	:= 0;
END;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_UPDATE" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_ATUAL_AFTER" 
AFTER INSERT OR UPDATE ON man_ordem_servico
FOR EACH ROW
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionrio [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatrios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de ateno:
	Parmetro 299 - [194] - Enviar comunicao interna ao solicitante ao alterar o estgio da ordem de servio
-------------------------------------------------------------------------------------------------------------------
Referncias:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */

nm_usuario_exec_w		varchar2(15);
qt_reg_w				number(1);
nm_user_w			varchar2(30);
nr_seq_funcao_w			number(10);
nr_seq_gerencia_w			number(10,0);
nr_seq_gerencia_sup_w		number(10,0);
qt_existe_w			number(10,0);

ie_desenv_w			varchar2(01) := 'S';
nr_seq_plano_w			number(10,0);
nr_seq_meta_os_w     	   	number(10,0);
ie_tipo_os_meta_w			varchar2(03);
dt_geracao_meta_w		date;

nr_seq_proj_vinc_w			number(10,0);
nr_seq_proj_orig_w			number(10,0);
nr_seq_proj_acomp_w		number(10,0);
nr_seq_tipo_exec_w		number(10);
ie_adiciona_exec_w		varchar2(15);
nm_usu_resp_geren_w		varchar2(15);
nm_usuario_fila_w			varchar2(50);
ds_sep_bv_w			varchar2(50) := obter_separador_bv;
nr_seq_skill_w			FUNCAO_GRUPO_DES.NR_SEQ_SKILL%Type;
qt_existe_exec_w			number(10);

nr_seq_cliente_w		number(10);
ie_possui_executor_w		varchar2(1);
ie_cliente_direto_w		varchar2(1);
ie_envia_ci_alt_estagio_w	varchar2(255);
nr_seq_classif_w		comunic_interna_classif.nr_sequencia%type;
nm_usuario_destino_w		usuario.nm_usuario%type;

BEGIN
if	(wheb_usuario_pck.get_ie_executar_trigger	= 'N')  then
	goto Final;
end if;

if	(:new.nr_seq_grupo_des is not null) then

	if	(nvl(:new.nr_seq_origem,0) > 0) then /*Verificar se  uma OS de reviso */

		select	max(nr_seq_gerencia)
		into	nr_seq_gerencia_w
		from	grupo_desenvolvimento
		where	nr_sequencia	= :new.nr_seq_grupo_des;

		if	(nr_seq_gerencia_w in(3,11)) and
			(:new.nr_seq_localizacao = 1272) then
			select	max(a.nm_usuario_exec)
			into	nm_usuario_exec_w
			from	man_ordem_servico_exec a
			where	nr_seq_ordem = :new.nr_seq_origem
			and		nm_usuario_exec <> 'Haertel'
			and		dt_fim_execucao is null
			and		exists (	select	1
								from	usuario_grupo_des b
								where	a.nm_usuario_exec	= b.nm_usuario_grupo
								and		nvl(b.IE_FUNCAO_USUARIO,'XPTO') <> 'N');

			if	(nm_usuario_exec_w is not null) then
				select	max(nm_usuario_exec)
				into	nm_usuario_fila_w
				from	man_ordem_servico_exec a
				where	nr_seq_ordem = :new.nr_seq_origem
				and		dt_fim_execucao is not null
				and		exists (select	1
								from	cadastro_fila b
								where	a.nm_usuario_exec = b.nm_usuario_fila);
			end if;
		end if;
	end if;

	if (nm_usuario_exec_w is null) then
		Select	min(a.nm_usuario_exec),
			min(a.nr_seq_skill)
		into	nm_usuario_exec_w,
			nr_seq_skill_w
		from	funcao_grupo_des a,
			funcao_grupo_des_cli c
		where	a.cd_funcao	= :new.cd_funcao
		and	a.nr_seq_grupo	= :new.nr_seq_grupo_des
		AND	a.nr_sequencia = c.nr_seq_funcao_grupo
		and	c.nr_seq_localizacao = :new.nr_seq_localizacao;

		if (nm_usuario_exec_w is null) then
			Select	NVL(min(a.nm_usuario_exec), obter_executor_desenv_item(:new.nr_seq_func_item, :new.cd_funcao, :new.nr_seq_grupo_des)),
				min(a.nr_seq_skill)
			into	nm_usuario_exec_w,
				nr_seq_skill_w
			from	funcao_grupo_des a
			where	a.cd_funcao	= :new.cd_funcao
			and	a.nr_seq_grupo	= :new.nr_seq_grupo_des
			and NVL(a.nr_seq_func_item, 0) = NVL(:new.nr_seq_func_item, 0)
			and	not exists (select 1
				from	funcao_grupo_des_cli x
				where	a.nr_sequencia = x.nr_seq_funcao_grupo);
		end if;
	end if;

else
	Select	min(a.nm_usuario_exec),
		min(a.nr_seq_skill)
	into	nm_usuario_exec_w,
		nr_seq_skill_w
	from	grupo_desenvolvimento b,
		funcao_grupo_des a,
		funcao_grupo_des_cli c
	where	a.nr_seq_grupo	= b.nr_sequencia
	and	a.cd_funcao	= :new.cd_funcao
	AND	a.nr_sequencia = c.nr_seq_funcao_grupo
	and	c.nr_seq_localizacao = :new.nr_seq_localizacao;

	if (nm_usuario_exec_w is null) then

		select NVL(min(a.nm_usuario_exec), obter_executor_desenv_item(:new.nr_seq_func_item, :new.cd_funcao,:new.nr_seq_grupo_des)),
			   min(a.nr_seq_skill)
			   into nm_usuario_exec_w,
			        nr_seq_skill_w
		from funcao_grupo_des a
		where a.cd_funcao = :new.cd_funcao
		and NVL(a.nr_seq_func_item, 0) = NVL(:new.nr_seq_func_item, 0)
		and not exists (select 1 from funcao_grupo_des_cli x
		where a.nr_sequencia = x.nr_seq_funcao_grupo);

	end if;
end if;

select	count(*)
into	qt_existe_w
from	man_ordem_servico_exec a
where	a.nr_seq_ordem	= :new.nr_sequencia
and	exists (	select	1
			from	usuario_grupo_des b
			where	a.nm_usuario_exec	= b.NM_USUARIO_GRUPO);

select	username
into	nm_user_w
from	user_users;

if	(:new.nr_seq_corresp is null) and
	(nm_usuario_exec_w is not null) and
	(qt_existe_w = 0) then
	if	(nm_user_w = 'CORP') then
		nr_seq_funcao_w	:= 31; /* Analise */

		/* Francisco/Adriano - 18/08/2010 - Colocar como responsvel pela Anlise */
		select	max(a.nr_sequencia)
		into	nr_seq_tipo_exec_w
		from	man_tipo_executor a
		where	a.ie_tipo_executor	= 3;
	end if;

	select	count(*)
	into	qt_existe_exec_w
	from	man_ordem_servico_exec
	where	nr_seq_ordem = :new.nr_sequencia
	and	nm_usuario_exec = nm_usuario_exec_w;

	if	(qt_existe_exec_w = 0) then
		insert into man_ordem_servico_exec(
			nr_sequencia,
			nr_seq_ordem,
			dt_atualizacao,
			nm_usuario,
			nm_usuario_exec,
			qt_min_prev,
			dt_recebimento,
			nr_seq_funcao,
			nr_seq_tipo_exec)
		select	man_ordem_servico_exec_seq.nextval,
			:new.nr_sequencia,
			sysdate,
			'Tasy',
			nm_usuario_exec_w,
			decode(nm_user_w,'CORP',10,45),/*45,  Francisco - 14/12/2010, mudei para 10 a pedido do Marcus */
			sysdate,
			nr_seq_funcao_w,
			nr_seq_tipo_exec_w
		from	dual;
	end if;
	if	(nm_user_w = 'CORP') then /* Gravar Ativ Prev de Anlise do lider*/
		/* Francisco - 04/12/2010 - O Marcus solicitou para fazer esta alterao, pois a partir desta data o analista deve definir
		as atividades previstas, os tempos e as datas */
		man_gerar_ativ_prevista(:new.nr_sequencia, nr_seq_funcao_w, 60, nm_usuario_exec_w,'N', 'Tasy',28,:new.ie_classificacao, :new.nr_seq_estagio, nvl(:new.nr_seq_origem,0), :new.NR_SEQ_LOCALIZACAO, nr_seq_gerencia_w);
		null;
	end if;

	if	(nm_usuario_fila_w is not null) then /* Inserir o executor da fila da OS de origem! */
		select	count(*)
		into	qt_existe_exec_w
		from	man_ordem_servico_exec
		where	nr_seq_ordem = :new.nr_sequencia
		and	nm_usuario_exec = nm_usuario_fila_w;

		if	(qt_existe_exec_w = 0) then
			insert into man_ordem_servico_exec(
				nr_sequencia,
				nr_seq_ordem,
				dt_atualizacao,
				nm_usuario,
				nm_usuario_exec,
				qt_min_prev,
				dt_recebimento,
				nr_seq_funcao,
				nr_seq_tipo_exec,
				dt_fim_execucao)
			select	man_ordem_servico_exec_seq.nextval,
					:new.nr_sequencia,
					sysdate,
					'Tasy',
					nm_usuario_fila_w,
					decode(nm_user_w,'CORP',10,45),/*45,  Francisco - 14/12/2010, mudei para 10 a pedido do Marcus */
					sysdate,
					nr_seq_funcao_w,
					nr_seq_tipo_exec_w,
					sysdate
			from	dual;
		end if;
	end if;

	if	(nr_seq_skill_w is not null) then

	    select  max(ie_desenv)
        into    ie_desenv_w
        from    man_estagio_processo
        where   nr_sequencia    = :new.nr_seq_estagio;

		if (ie_desenv_w = 'S') then

			insert into man_ordem_serv_skill(
				nr_sequencia,
				nr_seq_ordem_serv,
				nr_seq_skill,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec)
			values(	man_ordem_serv_skill_seq.nextval,
				:new.nr_sequencia,
				nr_seq_skill_w,
				sysdate,
				'Tasy',
				sysdate,
				'Tasy');
		end if;

	end if;

end if;

if	(inserting) and		/*Solicitao OS330098 - OS's do HSC sero sempre direcionadas ao desenvolvimento e sempre tero o usurio da Bruna*/
	(nm_user_w = 'CORP') and
	(:new.ie_classificacao = 'E') and
	(:new.nr_seq_localizacao = 15) then
	begin
	select	count(*)
	into	qt_existe_w
	from	man_ordem_servico_exec
	where	nr_seq_ordem	= :new.nr_sequencia
	and	nm_usuario_exec	= 'Bruna';

	if	(qt_existe_w = 0) then
		insert into man_ordem_servico_exec(
				nr_sequencia,
				nr_seq_ordem,
				dt_atualizacao,
				nm_usuario,
				nm_usuario_exec,
				qt_min_prev,
				dt_recebimento,
				nr_seq_funcao,
				nr_seq_tipo_exec)
			values(	man_ordem_servico_exec_seq.nextval,
				:new.nr_sequencia,
				sysdate,
				'Tasy',
				'Bruna',
				10,
				sysdate,
				null,
				3);
	end if;
	end;
end if;

if	(inserting) and
	(nm_user_w = 'CORP') then
	begin
	select	max(nr_seq_gerencia)
	into	nr_seq_gerencia_w
	from	grupo_desenvolvimento
	where	nr_sequencia	= :new.nr_seq_grupo_des;

	select	max(ie_adiciona_executor)
	into	ie_adiciona_exec_w
	from	desenv_regra_os_cliente
	where	nr_sequencia = (select	max(nr_sequencia)
				from	desenv_regra_os_cliente
				where	nvl(nr_seq_localizacao,:new.nr_seq_localizacao) = :new.nr_seq_localizacao
				and	nvl(ie_classificacao,:new.ie_classificacao) = :new.ie_classificacao
				and	nvl(nr_seq_gerencia,nr_seq_gerencia_w) = nr_seq_gerencia_w
				and	ie_situacao = 'A');

	select	max(b.nm_usuario)
	into	nm_usu_resp_geren_w
	from	usuario b,
		gerencia_wheb a
	where	b.cd_pessoa_fisica = a.cd_responsavel
	and	a.nr_sequencia = nr_seq_gerencia_w;

	if	(nvl(ie_adiciona_exec_w,'N') = 'S') and
		(nvl(nm_usu_resp_geren_w, 'X') <> 'X') then
		begin
		select	count(*)
		into	qt_existe_w
		from	man_ordem_servico_exec
		where	nr_seq_ordem	= :new.nr_sequencia
		and	nm_usuario_exec	= nm_usu_resp_geren_w;

		if	(qt_existe_w = 0) then
			insert into man_ordem_servico_exec(
					nr_sequencia,
					nr_seq_ordem,
					dt_atualizacao,
					nm_usuario,
					nm_usuario_exec,
					qt_min_prev,
					dt_recebimento,
					nr_seq_funcao,
					nr_seq_tipo_exec)
				values(	man_ordem_servico_exec_seq.nextval,
					:new.nr_sequencia,
					sysdate,
					'Tasy',
					nm_usu_resp_geren_w,
					10,
					sysdate,
					null,
					3);
		end if;
		end;
	end if;
	end;
end if;

if	(:old.cd_funcao is not null) and
	(:new.cd_funcao <> :old.cd_funcao) then
	insert into man_ordem_serv_funcao(
			nr_sequencia,
			nr_seq_ordem_serv,
			cd_funcao,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec)
		values(	man_ordem_serv_funcao_seq.nextval,
			:new.nr_sequencia,
			:old.cd_funcao,
			sysdate,
			:new.nm_usuario,
			sysdate,
			:new.nm_usuario);
end if;

select	max(a.nm_usuario_lider),
	max(a.nr_seq_gerencia_sup)
into	nm_usuario_exec_w,
	nr_seq_gerencia_sup_w
from	grupo_suporte a
where	a.nr_sequencia = :new.nr_seq_grupo_sup;

/*Anderson em 27/05/2010 - Ao passar automaticamente para desenv. aguardando triagem,
o usurio do suporte no esta mais sendo criado, gerar o lder do grupo do suporte nestes casos*/
if	(nm_user_w = 'CORP') then
	begin
	if 	/*( :new.nr_seq_estagio = 1051) and -- Aguardando Triagem desenvolvimento - retirei tratamento do estgio, pois ao alterar apenas a funo, ele no gerava o usurio suporte*/
		(:new.ie_classificacao in ('T','S','E')) then /*Solicitao / Sugesto / Erro*/
		begin
		select	max(nr_seq_gerencia)
		into	nr_seq_gerencia_w
		from	grupo_desenvolvimento
		where	nr_sequencia	= :new.nr_seq_grupo_des;

		if	(nr_seq_gerencia_w in (2,3,4,7,11,17,20,21,60)) then
			begin
			if	(nvl(nr_seq_gerencia_sup_w,0) <> 12) and
				(:new.nr_seq_proj_cron_etapa is null) and
				(:new.cd_funcao is not null) then /*No deve gerar o lder do grupo 'testes' pois a prpria analista de testes se coloca como executora*/
				select	count(*)
				into	qt_existe_w
				from	man_ordem_servico_exec
				where	nm_usuario_exec	= nvl(nm_usuario_exec_w,'Simone')
				and	nr_seq_ordem	= :new.nr_sequencia;

				if	(qt_existe_w = 0) then
					insert into man_ordem_servico_exec(
						nr_sequencia,
						nr_seq_ordem,
						dt_atualizacao,
						nm_usuario,
						nm_usuario_exec,
						qt_min_prev,
						dt_recebimento,
						nr_seq_funcao)
					select	man_ordem_servico_exec_seq.nextval,
						:new.nr_sequencia,
						sysdate,
						'Tasy',
						nvl(nm_usuario_exec_w,'Simone'),
						45,
						sysdate,
						nr_seq_funcao_w
					from	dual;
				end if;
			end if;
			end;
		end if;
		end;
	end if;

	if	(updating) and
		(:new.ie_status_ordem = 3) then
		begin
		select	count(*)
		into	qt_existe_w
		from	proj_ata_pendencia b,
			proj_ata_pendencia_os a
		where	a.nr_seq_ordem 		= :new.nr_sequencia
		and	a.nr_seq_pendencia	= b.nr_sequencia
		and	b.ie_status 		<> 'C'; /*concluida*/

		if	(qt_existe_w > 0) then
			update	proj_ata_pendencia b
			set	b.ie_status 		= 'C',
				b.dt_conclusao_real	= sysdate,
				b.dt_atualizacao	= sysdate,
				b.nm_usuario		= :new.nm_usuario
			where	exists (select	1
					from	proj_ata_pendencia_os a
					where	a.nr_seq_ordem 		= :new.nr_sequencia
					and	a.nr_seq_pendencia	= b.nr_sequencia)
			and	b.ie_status 		<> 'C';
		end if;
		end;
	end if;
	end;
end if;

if	(nm_user_w = 'CORP') and
	(nvl(nm_usuario_exec_w,'X') <> 'X') and
	(:new.nr_seq_grupo_sup is not null) and
	((inserting and :new.nr_seq_grupo_sup <> 31) or (not inserting)) then	/*Testes - ao cadastrar no deve ir para ningum, elas que adicionam o executor*/
	/*S adicionar o analista/lder do suporte caso no tenha nenhum usurio do grupo como executor*/
	select	count(*)
	into	qt_existe_w
	from	usuario_grupo_sup b,
		man_ordem_servico_exec a
	where	a.nr_seq_ordem	= :new.nr_sequencia
	and	b.nr_seq_grupo	= :new.nr_seq_grupo_sup
	and	a.nm_usuario_exec = b.nm_usuario_grupo;

	select	count(*)
	into	qt_existe_exec_w
	from	man_ordem_servico_exec
	where	nr_seq_ordem = :new.nr_sequencia
	and	nm_usuario_exec = nvl(nm_usuario_exec_w,'Simone');

	if	(qt_existe_w = 0) and
		(qt_existe_exec_w = 0)then
		insert into man_ordem_servico_exec(
			nr_sequencia,
			nr_seq_ordem,
			dt_atualizacao,
			nm_usuario,
			nm_usuario_exec,
			qt_min_prev,
			dt_recebimento,
			nr_seq_funcao)
		select	man_ordem_servico_exec_seq.nextval,
			:new.nr_sequencia,
			sysdate,
			'Tasy',
			nvl(nm_usuario_exec_w,'Simone'),
			45,
			sysdate,
			nr_seq_funcao_w
		from	dual;
	end if;
end if;

if      (nm_user_w = 'CORP') and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio) then
        begin
        select  max(ie_desenv)
        into    ie_desenv_w
        from    man_estagio_processo
        where   nr_sequencia    = :new.nr_seq_estagio;

		-------- GESTO DOS REQUISITOS LEVANTADOS NA ALEMANHA E OUTROS PASES
		if	(:new.nr_seq_estagio in (2216,1811)) then -- Aguardando Informaes Produto, Desenv pendente anlise de negcio
			update	latam_requisito
			set		ie_situacao_req = 'P' -- Produto
			where  	nr_seq_ordem_serv = :new.nr_sequencia;
		elsif (:new.nr_seq_estagio in (2218,2226,2228,2230)) then -- Aguardando Informaes GSS,  Aguardando Informaes GSS - Cliente, Aguardando Informaes GSS - Anlise, Aguardando Informaes GSS Configurao
			update	latam_requisito
			set		ie_situacao_req = 'C' -- Consultoria
			where  	nr_seq_ordem_serv = :new.nr_sequencia;
		elsif (nvl(ie_desenv_w,'N') = 'S') then -- Desenvolvimento
			update	latam_requisito
			set		ie_situacao_req = 'D' -- Desenvolvimento
			where  	nr_seq_ordem_serv = :new.nr_sequencia;
		end if;

	select	substr(proj_obter_dados_ordem_serv(:new.nr_sequencia, 'PROJ'),1,10) nr_seq_proj_vinc,
		substr(proj_obter_dados_ordem_serv(:new.nr_sequencia, 'PROJD'),1,10) nr_seq_proj_orig,
		substr(proj_obter_dados_ordem_serv(:new.nr_sequencia, 'PROJA'),1,10) nr_seq_proj_acomp
	into	nr_seq_proj_vinc_w,
		nr_seq_proj_orig_w,
		nr_seq_proj_acomp_w
	from	dual;

        if	(ie_desenv_w = 'S') and
		(nvl(nr_seq_proj_vinc_w,'0') = '0') and
		(nvl(nr_seq_proj_orig_w,'0') = '0') and
		(nvl(nr_seq_proj_acomp_w,'0') = '0') then

		select  max(nr_seq_gerencia)
		into    nr_seq_gerencia_w
		from    grupo_desenvolvimento
		where   nr_sequencia            = :new.nr_seq_grupo_des;

		select  nvl(max(nr_sequencia),0)
		into    nr_seq_plano_w
		from    desenvolvimento_plano_meta
		where   nr_seq_gerencia         = nr_seq_gerencia_w
		and     dt_meta_real is null;

		select	max(dt_geracao)
		into	dt_geracao_meta_w
		from	desenvolvimento_plano_meta
		where	nr_sequencia	= nr_seq_plano_w;

		if	(nr_seq_plano_w > 0) and
			(dt_geracao_meta_w >= :new.dt_ordem_servico) then
			select  count(*)
			into    qt_reg_w
			from    desenv_plano_meta_os
			where   nr_seq_plano            = nr_seq_plano_w
			and	NR_SEQ_ORDEM_SERV       = :new.nr_sequencia;

			if	(qt_reg_w = 0) then
				select  desenv_plano_meta_os_seq.nextval
				into    nr_seq_meta_os_w
				from    dual;

				if	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), to_date('01/01/2007','dd/mm/yyyy'), sysdate -60) = 'S') then
					ie_tipo_os_meta_w	:= '0';
				elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 59, sysdate -45) = 'S') then
					ie_tipo_os_meta_w	:= '1';
				elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 44, sysdate -30) = 'S') then
					ie_tipo_os_meta_w	:= '2';
				elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 29, sysdate -15) = 'S') then
					ie_tipo_os_meta_w	:= '3';
				elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 14, sysdate -7) = 'S') then
					ie_tipo_os_meta_w	:= '4';
				elsif	(obter_se_data_periodo(trunc(:new.dt_ordem_servico, 'dd'), sysdate - 6, sysdate) = 'S') then
					ie_tipo_os_meta_w	:= '5';
				end if;

				if	(ie_tipo_os_meta_w is not null) then
					insert  into desenv_plano_meta_os
							(nr_sequencia,
							nr_seq_plano,
							nr_seq_ordem_serv,
							dt_atualizacao,
							nm_usuario,
							dt_atualizacao_nrec,
							nm_usuario_nrec,
							ie_tipo_os_meta,
							nr_seq_estagio_orig,
							nr_seq_estagio_meta,
							ie_recorrente)
					values		(nr_seq_meta_os_w,
							nr_seq_plano_w,
							:new.nr_sequencia,
							sysdate,
							:new.nm_usuario,
							sysdate,
							:new.nm_usuario,
							ie_tipo_os_meta_w,
							:new.nr_seq_estagio,
							null, 'S');
				end if;
			end if;
		end if;
	end if;
        end;
end if;

if	(nm_user_w = 'CORP') and
	(:new.ie_status_ordem = 3) and
	(nvl(:old.ie_status_ordem,1) <> :new.ie_status_ordem) and
	(:new.nr_seq_nivel_valor = 1) then
	begin
	select	count(*)
	into	qt_existe_w
	from	gpw_pendencia
	where	nr_seq_ordem_serv = :new.nr_sequencia;

	if	(qt_existe_w = 0) then
		exec_sql_dinamico_bv('','begin gpw_gerar_pendencia_ordem_serv(:nr_sequencia,:nm_usuario); end;',
					'nr_sequencia=' || :new.nr_sequencia || ds_sep_bv_w ||
					'nm_usuario=' || :new.nm_usuario || ds_sep_bv_w);
	end if;
	end;
end if;

if	(:old.nr_seq_grupo_sup is not null) and
	(:new.nr_seq_grupo_sup <> :old.nr_seq_grupo_sup) then
	begin
	insert	into man_ordem_log_grupo_sup
					(nr_sequencia,
					 dt_atualizacao,
					 nm_usuario,
					 dt_atualizacao_nrec,
					 nm_usuario_nrec,
					 nr_seq_ordem_serv,
					 nr_seq_grupo_sup)
		values 		(man_ordem_log_grupo_sup_seq.nextval,
					 sysdate,
					 :new.nm_usuario,
					 sysdate,
					 :new.nm_usuario,
					 :new.nr_sequencia,
					 :new.nr_seq_grupo_sup);
	end;
end if;

if	(inserting) or
	((updating) and (nvl(:new.nr_seq_grupo_des,0) <> nvl(:old.nr_seq_grupo_des,0))) then
	begin
	insert	into man_ordem_log_grupo_des(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_ordem_serv,
		nr_seq_grupo_des,
		cd_funcao)
	values(	man_ordem_log_grupo_des_seq.nextval,
		sysdate,
		nvl(wheb_usuario_pck.get_nm_usuario, :new.nm_usuario),
		sysdate,
		nvl(wheb_usuario_pck.get_nm_usuario, :new.nm_usuario),
		:new.nr_sequencia,
		:new.nr_seq_grupo_des,
		:old.cd_funcao);
	end;
end if;

if	(inserting) and	(user = 'CORP') then
	select	decode(count(*),0,'N','S')
	into	ie_possui_executor_w
	from	man_ordem_servico_exec
	where	nr_seq_ordem = :new.nr_sequencia;

	if	(ie_possui_executor_w = 'N') and
		(:new.nr_seq_localizacao = 52) and
		(:new.nr_seq_equipamento = 1362) and
		(:new.nr_seq_estagio = 371) then

		select	max(nr_sequencia)
		into	nr_seq_cliente_w
		from	com_cliente
		where	dt_atualizacao = (select max(dt_atualizacao) from com_cliente);

		select	decode(count(*),0,'N','S')
		into	ie_cliente_direto_w
		from	com_canal a,
			com_canal_cliente b
		where	a.nr_sequencia = b.nr_seq_canal
		and	a.nr_sequencia = 3 -- Philips
		and	b.ie_tipo_atuacao = 'V' -- Venda
		and	b.dt_fim_atuacao is null
		and	b.nr_seq_cliente = nr_seq_cliente_w;

		if 	(ie_cliente_direto_w = 'S') then
			select	max(nm_usuario)
			into	nm_usuario_exec_w
			from	usuario
			where	cd_pessoa_fisica = (	select	max(cd_responsavel)
							from	gerencia_wheb
							where	nr_sequencia = :new.nr_seq_localizacao); -- Ps vendas
		else
			nm_usuario_exec_w := 'EPolastri';
		end if;

		insert into man_ordem_servico_exec (	nr_sequencia,
							nr_seq_ordem,
							dt_atualizacao,
							nm_usuario,
							nm_usuario_exec)
		values( man_ordem_servico_exec_seq.nextVal,
			:new.nr_sequencia,
			sysdate,
			'Tasy',
			nm_usuario_exec_w);

	end if;
end if;

if	(:old.nr_seq_estagio != :new.nr_seq_estagio) and
	(:old.nr_seq_estagio is not null) and
	(:new.nr_seq_estagio is not null) then
	ie_envia_ci_alt_estagio_w	:= nvl(Obter_Valor_Param_Usuario(299,194,Obter_Perfil_Ativo,:new.nm_usuario,0),'N');

	if	(ie_envia_ci_alt_estagio_w = 'S') then
		select	min(nr_sequencia)
		into	nr_seq_classif_w
		from	comunic_interna_classif
		where	ie_tipo	= 'F';

		Gerar_Comunic_Padrao
			(sysdate,
			wheb_mensagem_pck.get_texto(439851,'NR_SEQ_ORDEM=' || :new.nr_sequencia),
			wheb_mensagem_pck.get_texto(439852,'NR_SEQ_ORDEM=' || :new.nr_sequencia || ';DS_EST_ANT=' || substr(man_obter_dados_estagio(:old.nr_seq_estagio, 'D'),1,60) || ';DS_EST_ATUAL=' || substr(man_obter_dados_estagio(:new.nr_seq_estagio, 'D'),1,60)),
			:new.nm_usuario,
			'N',
			substr(obter_usuario_pessoa(:new.cd_pessoa_solicitante),1,15),
			'N',
			nr_seq_classif_w,
			null,
			null,
			null,
			sysdate,
			null,
			null);
	end if;
end if;

nm_usuario_exec_w	:= null;
<<Final>>
qt_reg_w	:= 0;

END;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_ATUAL_AFTER" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_ATUAL" 
BEFORE INSERT OR UPDATE ON man_ordem_servico
FOR EACH ROW
DECLARE
qt_doc_erro_w					number(10);
qt_reg_w						number(10,0);
qt_existe_w						number(10,0);
qt_existe_orc_w					number(10,0);
cd_setor_atendimento_w			number(10,0);

qt_registro_w					number(10);
nr_seq_estagio_w				number(10);
ie_estagio_new_tec_w			number(10)		:= 0;
ie_estagio_old_tec_w			number(10)		:= 0;
ie_gerar_grupo_des_w			varchar2(01)	:= 'S';
nr_seq_gerencia_w				number(10,0);
ds_tipo_w						varchar2(255);
nr_seq_sla_w					number(10,0);
qt_reg_analista_w				number(10,0);
nr_seq_sla_ww					number(10,0);
nr_seq_sla_regra_w				number(10,0);
nr_seq_sla_regra_ww				number(10,0);
qt_estagio_desenv_w				number(10);
ie_estagio_atual_desen_w		varchar2(1);
ie_limpar_data_real_reab_w		varchar2(1);
ie_produto_w					varchar2(15);
ds_mensagem_sms_w				varchar2(255);
nm_usuario_lider_w				varchar2(255);
ie_recebe_desenv_w				varchar2(15);
nm_usuario_negonio_w			varchar2(255);
ie_sms_w						varchar2(15);
nr_telefone_celular_w			varchar2(15);
nr_telefone_celular_adic_w		varchar2(15);
nm_usuario_lider_sup_w			varchar2(15);
ds_enter_w						varchar2(2)		:= chr(13) || chr(10);

ds_responsavel_teste_comp_w		varchar(60);
ds_responsaveis_teste_comp_w	varchar2(2000);
nr_seq_estagio_padrao_w			number(10,0);
ie_desenv_w						varchar2(01)	:= 'S';
ie_suporte_w					varchar2(01)	:= 'S';
ie_tecnologia_w					varchar2(01)	:= 'S';
ie_testes_w						varchar2(01)	:= 'S';
nr_seq_ativ_exec_w				number(10);
nm_usuario_manutencao_w			varchar2(15);

ie_tec_w						varchar2(1);
ie_des_w						varchar2(1);
ie_tecnologia_old_w				varchar2(1);
ie_desenv_new_w					varchar2(1);

/*SLA*/
cd_estabelecimento_w			number(04,0)	:= wheb_usuario_pck.get_Cd_estabelecimento;
qt_min_termino_w				number(15,0)	:= 0;
qt_min_inicio_w					number(15,0)	:= 0;
nr_seq_skill_w					number(15,0);
ie_tempo_w						varchar2(15);
ie_utiliza_sla_w				varchar2(15);
ie_gerar_dt_fim_prev_sla_w		varchar2(15);
ie_gerar_dt_inicio_prev_sla_w	varchar2(15);
ds_retorno_w					varchar2(2000)	:= null;

nr_seq_pendencia_w				number(10);
cd_pessoa_adic_w				varchar2(10);
nr_seq_solic_sd_w				number(10);
ie_acao_solic_w					varchar2(2);
nr_seq_mot_canc_solic_w			number(10);

nr_seq_gerencia_sup_w			grupo_suporte.nr_seq_gerencia_sup%type;
ie_status_w						varchar2(1);

ie_abrangencia_w				varchar2(1);
ie_delphi_w						varchar2(1);
ie_java_w						varchar2(1);
ie_html5_w						varchar2(1);
ie_terceiro_w					varchar2(1);
qt_ativ_programacao_w			number(10,0);
qt_hist_code_review_w			number(10,0);

/*Acordo Cliente*/
nr_seq_des_acordo_os_w			number(10);

ie_acao_w						number(10);
nm_usuario_email_w				varchar2(255);
ds_usu_mail_w					varchar2(255);
ie_base_corp_w 					varchar2(1);
ie_base_wheb_w 					varchar2(1);

Cursor C01 is
	/*Verificar os responsveis por realiazr testes em componentes*/
	select 	obter_nome_usuario(c.nm_usuario_lider)
	From	Componente_Tasy a,
		Comp_Grupo_Desenv b,
		grupo_desenvolvimento c
	Where	a.Nr_Sequencia = B.Nr_Seq_Comp_Tasy
	and	C.Nr_Sequencia = B.Nr_Seq_Grupo
	and	a.cd_componente = :new.ie_componente
	and	Not Exists ( Select 1
				From	Man_Ordem_Serv_Tecnico d
				Where	d.nr_Seq_Ordem_Serv = :new.nr_sequencia
				And	d.nr_seq_tipo	= 30
				and	d.nm_usuario 	= c.nm_usuario_lider);


cursor c02 is
	select	nr_seq_ativ_exec
	from	man_ordem_ativ_prev
	where	nr_seq_ordem_serv = :new.nr_sequencia
	and		nr_seq_ativ_exec in (58,115,120,130,131,124);

CURSOR c03 IS
SELECT	ie_recebe_desenv,
		ie_sms,
		cd_pessoa_adic
		FROM	desenv_regra_os_cliente  a
		WHERE	NVL(nr_seq_localizacao,:NEW.nr_seq_localizacao) = :NEW.nr_seq_localizacao
		AND	NVL(ie_classificacao,:NEW.ie_classificacao) = :NEW.ie_classificacao
		AND	NVL(nr_seq_gerencia, nr_seq_gerencia_w) = nr_seq_gerencia_w
		AND	NVL(nr_seq_grupo_des, :new.nr_seq_grupo_des) = :new.nr_seq_grupo_des
		AND	NVL(nr_seq_grupo_sup, :new.nr_seq_grupo_sup) = :new.nr_seq_grupo_sup
		AND	((NVL(ie_terceiro, ie_terceiro_w) = ie_terceiro_w) or (ie_terceiro = 'A'))
		AND	ie_situacao = 'A'
		AND	man_verificar_vigencia_regra(:NEW.dt_ordem_servico, a.dt_inicio, a.dt_fim) = 'S'
		ORDER BY NVL(a.dt_inicio, SYSDATE) DESC,
				NVL(a.dt_fim, SYSDATE) DESC,
				NVL(a.cd_funcao, 9999999999) DESC,
				NVL(a.nr_seq_grupo_des, 9999999999) DESC,
				NVL(a.nr_seq_grupo_sup, 9999999999) DESC,
				NVL(a.nr_seq_gerencia, 9999999999) DESC,
				NVL(a.ie_classificacao, 'ZZZZZZZZZZZ') DESC,
				NVL(a.nr_seq_localizacao, 9999999999) DESC;

cursor c04 is
	select  a.nm_usuario_grupo,
		b.ds_email
	from    gerencia_wheb_grupo_usu a,
		usuario b
	where   nr_seq_grupo = 249
	and     b.nm_usuario = a.nm_usuario_grupo;

BEGIN

ie_base_corp_w := obter_se_base_corp;
ie_base_wheb_w := obter_se_base_wheb;

select	max(cd_setor_atendimento)
into	cd_setor_atendimento_w
from 	usuario
where	nm_usuario	= :new.nm_usuario;

ie_gerar_grupo_des_w	:= nvl(Obter_Valor_Param_Usuario(299,228,Obter_Perfil_Ativo,:new.nm_usuario,0),'S');
ie_limpar_data_real_reab_w	:= nvl(Obter_Valor_Param_Usuario(299,343,Obter_Perfil_Ativo,:new.nm_usuario,0),'S');

if	(nr_seq_pendencia_w > 0) and
	(:new.dt_fim_previsto is not null) then
	begin
	if	(inserting) then
		begin
		update	proj_ata_pendencia a
		set	a.dt_repactuada 	= :new.dt_fim_previsto,
			a.nm_usuario	= :new.nm_usuario,
			a.dt_atualizacao 	= sysdate
		where	a.nr_sequencia	= nr_seq_pendencia_w;
		end;
	elsif	(UPDATING) and
			(:old.dt_fim_previsto <> :new.dt_fim_previsto) then
			begin
			update	proj_ata_pendencia a
			set	a.dt_repactuada	= :new.dt_fim_previsto,
				a.nm_usuario	= :new.nm_usuario,
				a.dt_atualizacao	= sysdate
			where	a.nr_sequencia	= nr_seq_pendencia_w;
			end;
	end if;
	end;
end if;


if	(UPDATING) and
	(:new.cd_funcao = 982) and
	(:old.ie_status_ordem <> :new.ie_status_ordem) then

	if (:new.ie_status_ordem = 1) then
		ie_status_w := 'B';
	elsif (:new.ie_status_ordem = 2) then
		ie_status_w := 'E';
	elsif (:new.ie_status_ordem = 3) then
		ie_status_w := 'F';
	end if;

	update 	pcs_agenda_atividades
	set	ie_status = ie_status_w
	where	nr_ordem_servico = :new.nr_sequencia;

end if;

if	(wheb_usuario_pck.get_ie_executar_trigger	= 'N')  then
	goto Final;
end if;

/*Cliente teste
Ok cliente encerrado
Aguardando informaes do cliente
testes
testes aguardando verso


Eliminar as atividades previstas futuras.
*/

--Bloqueio para no permitir abrir ORdem de Servio com a localizao do cliente, quando o usurio for do desenvolvimento
if	((ie_base_corp_w = 'S') and (:new.nr_seq_localizacao <> NVL(:old.nr_seq_localizacao,-1))) then
	SELECT count(*)
	into 	qt_registro_w
	FROM USUARIO_GRUPO_DES Y
	WHERE Y.NM_USUARIO_GRUPO = :new.nm_usuario_nrec;

	if (qt_registro_w > 0) then
		SELECT 	count(*)
		into	qt_registro_w
		FROM 	man_localizacao z
		WHERE 	ie_terceiro = 'S'
		and		z.nr_sequencia = :new.nr_seq_localizacao;

		if (qt_registro_w > 0) then
			wheb_mensagem_pck.exibir_mensagem_abort(1024347);
		end if;
	end if;
end if;





if	(ie_base_corp_w = 'S') and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio) and
	(:new.nr_seq_estagio in (2,9,41,791,1071,1511)) and
	(:new.ie_origem_os <> '2') then /*no fazer para iniciativas do BSC na corp - OS429191*/
	begin

	select	count(*)
	into	qt_existe_w
	from	man_ordem_ativ_prev
	where 	nr_seq_ordem_serv		= :new.nr_sequencia
	and	dt_prevista		>= trunc(sysdate + 1);

	if	(qt_existe_w > 0) then
		delete	man_ordem_ativ_prev a
		where	nr_seq_ordem_serv		= :new.nr_sequencia
		and	dt_prevista		>= trunc(sysdate + 1)
		and	not exists
			(select 1
			from MAN_ORDEM_SERV_ATIV x
			where x.NR_SEQ_ATIV_PREV = a.nr_sequencia);
	end if;
	end;
end if;

if	(ie_base_corp_w = 'S') and (:new.nr_seq_estagio <> :old.nr_seq_estagio) and (:new.nr_seq_severidade = 1) then
begin
	select 	ie_acao
	into	ie_acao_w
	from   	man_estagio_processo
	where  	nr_sequencia = :new.nr_seq_estagio;

	if (ie_acao_w = 2) then

		if (:new.nr_seq_severidade_wheb is null) then
			wheb_mensagem_pck.exibir_mensagem_abort(1023603);
		end if;

	end if;
end;
end if;

if	((:old.nr_seq_severidade_wheb = 1) and (:new.nr_seq_severidade_wheb <> :old.nr_seq_severidade_wheb)) then

	open c04;
	loop
	fetch c04 into
		nm_usuario_email_w,
		ds_usu_mail_w;
	exit when c04%notfound;
		begin
			if (ds_usu_mail_w is not null) then
				enviar_email('Service order severity changed', 'Service order ' || :new.nr_sequencia || 'severity changed', 'support.informatics@philips.com',
				ds_usu_mail_w, 'TASY', 'A');
			end if;
		end;
	end loop;
	close c04;
end if;

select	nvl(max(ie_delphi),'N'),
	nvl(max(ie_java),'N'),
	nvl(max(ie_html5),'N'),
	nvl(max(ie_terceiro),'S')
into	ie_delphi_w,
	ie_java_w,
	ie_html5_w,
	ie_terceiro_w
from	man_localizacao
where	nr_sequencia	= :new.nr_seq_localizacao;

if	(ie_base_corp_w = 'S') and
	(:new.ie_plataforma is null) and
	(:new.nr_seq_localizacao is not null) then


	if	(:new.cd_funcao in (2314,2815)) then /*CPOE ou Manchester na operao*/
		:new.ie_plataforma	:= 'H';
	elsif	((UPPER(:new.ds_dano) like '%HTML%') or (UPPER(:new.ds_dano_breve) like '%HTML%')) then
		:new.ie_plataforma	:= 'H';
	elsif	((UPPER(:new.ds_dano) like '%JAVA%') or (UPPER(:new.ds_dano_breve) like '%JAVA%')) then
		:new.ie_plataforma	:= 'S';
	elsif	(ie_delphi_w = 'S') and
		(ie_java_w = 'N') and
		(ie_html5_w = 'N') then
		:new.ie_plataforma	:= 'D';
	elsif	(ie_delphi_w = 'N') and
		(ie_java_w = 'S') and
		(ie_html5_w = 'N') then
		:new.ie_plataforma	:= 'S';
	elsif	(ie_delphi_w = 'N') and
		(ie_java_w = 'N') and
		(ie_html5_w = 'S') then
		:new.ie_plataforma	:= 'H';
	elsif	(:new.nr_seq_grupo_des is not null) then
		select	max(nr_seq_gerencia)
		into	nr_seq_gerencia_w
		from	grupo_desenvolvimento
		where	nr_sequencia	= :new.nr_seq_grupo_des;

		if	(nr_seq_gerencia_w in (82,86)) then /*gerncias do HTML5*/
			:new.ie_plataforma	:= 'H';
		end if;
	end if;
end if;

if	(ie_base_corp_w = 'S') and
	(:new.NR_SEQ_ESTAGIO in (4,731,732,761,131,31)) and
	(:new.NR_GRUPO_TRABALHO not in (132,72)) then
	:new.NR_GRUPO_TRABALHO	:= 2;
	:new.NR_GRUPO_PLANEJ		:= 2;
end if;

select	max(nr_seq_gerencia_sup)
into	nr_seq_gerencia_sup_w
from	grupo_suporte
where	nr_sequencia = :new.nr_Seq_grupo_sup;

if	(ie_base_corp_w = 'S') and
	(verifica_se_estagio_nv2(:new.NR_SEQ_ESTAGIO) = 'S') and
	(nr_seq_gerencia_sup_w in (5,58)) and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio) then
	:new.NR_GRUPO_TRABALHO	:= 262;
	:new.NR_GRUPO_PLANEJ		:= 2;
end if;

if	(ie_base_corp_w = 'S') and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio) then

	-- Edgar 13/10/2009, verificar se a OS foi para desenvolvimento
	if	(:old.nr_seq_estagio not in (4,731,732,741,261)) and
		(:new.nr_seq_estagio in (4,731,732,741,261)) then
		:new.DT_ULT_ACESSO_LIDER	:= null;
	end if;

	if	(:new.nr_seq_estagio = 151 ) then /*Retorno cliente*/
		begin
		if	(:new.ie_classificacao in ('T','S')) then /*Solicitao / Sugesto*/
			select 	max(nr_seq_estagio)
			into	nr_seq_estagio_w
			from   	man_ordem_serv_estagio c
			where  	c.nr_seq_ordem	= :new.nr_sequencia
			and    	c.nr_sequencia	=	(select max(a.nr_sequencia)
							from   	man_ordem_serv_estagio	a,
								man_estagio_processo	b
							where	a.nr_seq_ordem	= c.nr_seq_ordem
							and	a.nr_seq_estagio	= b.nr_sequencia
							and	b.ie_desenv	= 'S');

			-- Incluido begin-exception devido a OS 834422, pois a OS 821521 no havia grupo de desenvolvimento.
			begin
			select	b.nm_usuario_manutencao,
				b.nm_usuario_lider,
				b.nm_usuario_negonio,
				b.nr_seq_gerencia
			into	nm_usuario_manutencao_w,
				nm_usuario_lider_w,
				nm_usuario_negonio_w,
				nr_seq_gerencia_w
			from	grupo_desenvolvimento b
			where	b.nr_sequencia	= :new.nr_seq_grupo_des;
			exception
			when others then
				nr_seq_gerencia_w		:= null;
				nm_usuario_negonio_w	:= null;
				nm_usuario_lider_w		:= null;
				nm_usuario_manutencao_w	:= null;
			end;

			select	count(*)
			into	qt_reg_w
			from	man_ordem_servico_exec
			where	nr_seq_ordem	= :new.nr_sequencia
			and	nm_usuario_exec 	= nm_usuario_manutencao_w;

			select	count(*)
			into	qt_reg_analista_w
			from	man_ordem_servico_exec
			where	nr_seq_ordem	= :new.nr_sequencia
			and	nm_usuario_exec 	= nm_usuario_lider_w
			and	dt_fim_execucao is null;

			if 	(qt_reg_analista_w = 0) then
				select	count(*)
				into	qt_reg_analista_w
				from	man_ordem_servico_exec
				where	nr_seq_ordem	= :new.nr_sequencia
				and	nm_usuario_exec	= nm_usuario_negonio_w
				and	dt_fim_execucao is null;
			end if;

			if 	(qt_reg_analista_w = 0) and
				(nr_seq_gerencia_w <> 3) then /*S deve voltar para o analista de manuteno se no estiver sendo tratada pelo analista de negcios e nem o de sistemas*/
				if	(qt_reg_w > 0) then
					update	man_ordem_servico_exec a
					set	a.dt_fim_execucao 	= null
					where	a.nr_seq_ordem	= :new.nr_sequencia
					and	a.nm_usuario_exec 	= nm_usuario_manutencao_w;
				else
					if	(nvl(nm_usuario_manutencao_w,'X') <> 'X') then
						insert into man_ordem_servico_exec
							(nr_sequencia,
							nr_seq_ordem,
							dt_atualizacao,
							nm_usuario,
							nm_usuario_exec,
							qt_min_prev,
							nr_seq_tipo_exec,
							dt_atualizacao_nrec,
							nm_usuario_nrec)
						values	(man_ordem_servico_exec_seq.nextval,
							:new.nr_sequencia,
							sysdate,
							:new.nm_usuario,
							nm_usuario_manutencao_w,
							15,
							1,
							sysdate,
							:new.nm_usuario);
					end if;
				end if;
			end if;

			if 	(nr_seq_estagio_w is not null )  then
				select 	count(*)
				into	qt_reg_w
				from   	man_estagio_processo
				where	ie_tecnologia	= 'S'
				and    	nr_sequencia	= nr_seq_estagio_w;

				if	(qt_reg_w > 0) then
					/*Tecnologia*/
					:new.nr_seq_estagio := 131;
				else
					/*Desenvolvimento Retorno Cliente*/
					:new.nr_seq_estagio := 1051;--4;
				end if;
			end if;
		elsif	(:new.ie_classificacao = 'E') then /*Erro sempre voltar para o ltimo grupo - suporte, tecnologia ou desenv - OS405979*/
			begin
			select 	max(nr_seq_estagio)
			into	nr_seq_estagio_w
			from   	man_ordem_serv_estagio c
			where  	c.nr_seq_ordem	= :new.nr_sequencia
			and    	c.nr_sequencia	=	(select	max(a.nr_sequencia)
							from   	man_ordem_serv_estagio a,
								man_estagio_processo b
							where	a.nr_seq_ordem		= c.nr_seq_ordem
							and	a.nr_seq_estagio		= b.nr_sequencia
							and	b.ie_aguarda_cliente	= 'N'
							and	b.nr_sequencia not in (151,511,9,261));

			:new.nr_seq_estagio	:= nr_seq_estagio_w;
			end;
		end if;

		--Verifica se existe algum acordo para est OS, caso exista , define data de retono do cliente no acordo
		select	max(nr_sequencia)
		into	nr_seq_des_acordo_os_w
		from	desenv_acordo_os
		where	nr_seq_ordem_servico = :new.nr_sequencia;

			if	(nr_seq_des_acordo_os_w is not null) then
				update	desenv_acordo_os
				set	dt_retorno_cli = sysdate
				where	nr_sequencia = nr_seq_des_acordo_os_w;
			end if;

		end;
	else
		SELECT 	COUNT(*)
		into	qt_reg_w
		FROM   	man_estagio_processo
		WHERE  	ie_desenv = 'S'
		AND    	nr_sequencia = :new.nr_seq_estagio
		AND	not exists ( 	select	1
					from	man_estagio_processo
					where	ie_desenv = 'S'
					and	nr_sequencia = :old.nr_seq_estagio);

		if	( qt_reg_w > 0 ) then

			select	count(*)
			into	qt_reg_w
			from 	man_estagio_processo
			where	ie_tecnologia = 'S'
			and 	nr_sequencia = :new.nr_seq_estagio;

			if	( qt_reg_w > 0 ) then
				ie_estagio_new_tec_w	:= 1;
			end if;

			SELECT 	max(nr_seq_estagio)
			into	nr_seq_estagio_w
			FROM   	man_ordem_serv_estagio c
			WHERE  	c.nr_seq_ordem = :new.nr_sequencia
			AND    	c.nr_sequencia = (
				SELECT MAX(a.nr_sequencia)
				FROM   	man_ordem_serv_estagio a,
					man_estagio_processo b
				WHERE   a.nr_seq_ordem = c.nr_seq_ordem
				AND	a.nr_seq_estagio = b.nr_sequencia
				AND	b.ie_desenv = 'S');

			if 	( nr_seq_estagio_w is not null )  then

				SELECT 	COUNT(*)
				into	qt_reg_w
				FROM   	man_estagio_processo
				where	ie_tecnologia = 'S'
				AND    	nr_sequencia = nr_seq_estagio_w;

				if	(qt_reg_w > 0 ) then
					ie_estagio_old_tec_w := 1;
				end if;

				/*Verificar se setor do usurio  desenvolvimento*/
				select	count(*)
				into	qt_reg_w
				from	usuario
				where	cd_setor_atendimento in (2,16)
				and	nm_usuario = :new.nm_usuario;

				if (qt_reg_w > 0 ) then
					if	( ie_estagio_old_tec_w > 0 ) and
						( ie_estagio_new_tec_w = 0 ) and
						(:new.nm_usuario <> 'Tasy') then	/*Anderson 25/10/2010 - OS254470 - Para no bloquear a job de encerramento automtico*/
						wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173235);
					elsif   ( ie_estagio_old_tec_w = 0 ) and
						( ie_estagio_new_tec_w > 0 ) and
						(:new.nm_usuario <> 'Tasy') then	/*Anderson 25/10/2010 - OS254470 - Para no bloquear a job de encerramento automtico*/
						wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173236);
					end if;
				end if;
			end if;
		end if;
	end if;
end if;


if	(ie_base_corp_w = 'S') and
	(:old.nr_seq_severidade_wheb != :new.nr_seq_severidade_wheb)	and
	(:new.nr_seq_severidade_wheb in (1, 6))	and
	(:old.dt_teste_negocio is null)	and
	(:new.ie_classificacao in ('S','E')) then /*Solicitao / Defeito*/
	:new.dt_teste_negocio := sysdate;
end if;

if	(ie_base_corp_w = 'S') and
	((:old.nr_seq_severidade_wheb != :new.nr_seq_severidade_wheb)	and
	(:new.nr_seq_severidade_wheb not in (1, 6)))	or
	(:new.ie_classificacao not in ('S','E')) then /*Solicitao / Defeito*/
	:new.dt_teste_negocio := null;
end if;

if	(ie_base_corp_w = 'S') and
	(:new.ie_classificacao = 'E') and
	(:new.nr_seq_estagio in (2,9,1511)) then
	select	count(*)
	into	qt_doc_erro_w
	from	man_doc_erro
	where	nr_seq_ordem	= :new.nr_sequencia
	and	dt_liberacao is not null;

	if	(qt_doc_erro_w = 0) then
		wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173237);
	end if;
end if;

if	(ie_base_corp_w = 'S') and
	(:new.nr_seq_estagio in (2,9,1511)) then
	select	count(*)
	into	qt_existe_orc_w
	from	man_ordem_servico_orc
	where	nr_seq_ordem = :new.nr_sequencia
	and	dt_aprovacao is null
	and	dt_reprovacao is null;

	if	(qt_existe_orc_w > 0) then
		wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(303144);
	end if;
end if;

if	(updating) and
	(ie_base_corp_w = 'S') and
	(:new.dt_ordem_servico > to_date('11/05/2016','dd/mm/yyyy')) and --Somente ir pedir aprovao de code review se a OS foi criada DEPOIS que foi implementado essa rotina de Code Review (11/05/2016) . Mais detalhes verificar OS: 1402146
	(((:new.nr_seq_estagio in (2,791)) and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio)) or
	((:new.ie_status_ordem = 3) and
	(:old.ie_status_ordem <> :new.ie_status_ordem))) and
	(upper(:new.nm_usuario) <> 'WEBSERVICE') then --Estgio "Cliente (Teste)", "Testes" ou encerramento da OS.
	begin
	/* Verifica se existe atividade de programao para esta OS */
	select	count(1)
	into	qt_ativ_programacao_w
	from	man_ordem_serv_ativ
	where	nr_seq_funcao in (1288,11,551)
	and	nr_seq_ordem_serv = :new.nr_sequencia;

	if	(qt_ativ_programacao_w > 0)then
		begin
		/*Verifica se existe histrico do tipo Code Review*/
		select	count(1)
		into 	qt_hist_code_review_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 163
		and	nr_seq_ordem_serv = :new.nr_sequencia;

		if	(qt_hist_code_review_w = 0) then
			wheb_mensagem_pck.exibir_mensagem_abort(458500); /*Ateno! Para cada atividade de programao deve existir um histrico de "Aprovao de Code Review"*/
		end if;
		end;
	end if;
	end;
end if;

if	(ie_base_corp_w = 'S') and
	(:new.ie_status_ordem = 3) and
	(:old.ie_status_ordem <> :new.ie_status_ordem) and
	(upper(:new.nm_usuario) <> 'WEBSERVICE') then

	/*Verifica se existe atividade de programao para esta OS*/
	select	count(1)
	into	qt_ativ_programacao_w
	from	man_ordem_serv_ativ
	where	nr_seq_funcao in (1288,11,551)
	and		nr_seq_ordem_serv = :new.nr_sequencia;

	if	(qt_ativ_programacao_w > 0)then

	/*Verifica se existe histrico do tipo "Teste do programador" */
		select	count(1)
		into 	qt_hist_code_review_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 12
		and		nr_seq_ordem_serv = :new.nr_sequencia;

		if	(qt_hist_code_review_w = 0) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(798715); /* obrigatrio o registro de ao menos um histrico do tipo "Teste do programador" para encerrar esta OS! */
		end if;


		/*Verifica se existe histrico do tipo "Teste do analista" */
		select	count(1)
		into 	qt_hist_code_review_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 31
		and		nr_seq_ordem_serv = :new.nr_sequencia;


		if	(qt_hist_code_review_w = 0) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(798729); /* obrigatrio o registro de ao menos um histrico do tipo "Teste do analista" para encerrar esta OS!*/
		end if;


	end if;
end if;



if	(ie_base_corp_w = 'S') and
	(:new.ie_grau_satisfacao in ('P','R')) and
	(:new.nr_seq_justif_grau_satisf is null) and
	(:new.ie_status_ordem = 3) and
	(upper(:new.nm_usuario) <> 'WEBSERVICE') then
	wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(184368);
end if;

if	(:new.nr_seq_grupo_des is null) and
	(:new.cd_funcao is not null) and
	(ie_gerar_grupo_des_w = 'S') then
	if	(ie_base_corp_w = 'S') then
		select	max(ie_produto)
		into	ie_produto_w
		from	com_cliente
		where nr_sequencia = :new.NR_SEQ_CLIENTE;

		begin
			if	(inserting) and
				(:new.NR_SEQ_CLIENTE	is not null) then
				select	max(x.NR_SEQ_GRUPO_DES)
				into	:new.nr_seq_grupo_des
				from	FUNCAO_GRUPO_LOC x
				where	x.NR_SEQ_CLIENTE	= :new.nr_seq_cliente
				and	nvl(x.CD_FUNCAO,:new.CD_FUNCAO) = :new.CD_FUNCAO
				and	nvl(x.IE_CLASSIFICACAO,:new.IE_CLASSIFICACAO) = :new.IE_CLASSIFICACAO
				and	Obter_Se_Entre_Horario(sysdate,x.HR_INICIO, x.HR_FIM) = 'S';

			end if;

		exception
		when others then
			:new.nr_seq_grupo_des	:= null;
		end;


		if	(:new.nr_seq_grupo_des	is null) then

			select	min(b.nr_sequencia),
					min(a.nr_seq_skill)
			into	:new.nr_seq_grupo_des,
					nr_seq_skill_w
			from	grupo_desenvolvimento b,
				funcao_grupo_des a,
				funcao_grupo_des_cli c
			where	a.nr_seq_grupo	= b.nr_sequencia
			AND	a.nr_sequencia 	= c.nr_seq_funcao_grupo
			and	b.ie_situacao	= 'A'
			and	a.cd_funcao	= :new.cd_funcao
			and	c.nr_seq_localizacao = :new.nr_seq_localizacao
			and 	((ie_produto_w='P' and b.nr_sequencia <> 45) or (ie_produto_w='O' and b.nr_sequencia <> 4) or (ie_produto_w is null));

		end if;

		if	(:new.nr_seq_grupo_des is null) then
			select	min(b.nr_sequencia),
					min(a.nr_seq_skill)
			into	:new.nr_seq_grupo_des,
					nr_seq_skill_w
			from	grupo_desenvolvimento b,
				funcao_grupo_des a
			where	a.nr_seq_grupo	= b.nr_sequencia
			and	b.ie_situacao	= 'A'
			and	a.cd_funcao	= :new.cd_funcao
			and 	((ie_produto_w='P' and b.nr_sequencia <> 45) or (ie_produto_w='O' and b.nr_sequencia <> 4) or (ie_produto_w is null))
			and	not exists (select 1
					from	funcao_grupo_des_cli x
					where	a.nr_sequencia = x.nr_seq_funcao_grupo);
		end if;

	end if;

	if	(:new.nr_seq_grupo_des is null) then
		select	min(b.nr_sequencia),
			min(a.nr_seq_skill)
		into	:new.nr_seq_grupo_des,
			nr_seq_skill_w
		from	grupo_desenvolvimento b,
			funcao_grupo_des a,
			funcao_grupo_des_cli c
		where	a.nr_seq_grupo	= b.nr_sequencia
		AND	a.nr_sequencia = c.nr_seq_funcao_grupo
		and	b.ie_situacao	= 'A'
		and	a.cd_funcao	= :new.cd_funcao
		and	c.nr_seq_localizacao = :new.nr_seq_localizacao;
	end if;

	if	(:new.nr_seq_grupo_des is null) then
		select	min(b.nr_sequencia),
			min(a.nr_seq_skill)
		into	:new.nr_seq_grupo_des,
			nr_seq_skill_w
		from	grupo_desenvolvimento b,
			funcao_grupo_des a
		where	a.nr_seq_grupo	= b.nr_sequencia
		and	b.ie_situacao	= 'A'
		and	a.cd_funcao	= :new.cd_funcao
		and	not exists (select	1
				from	funcao_grupo_des_cli x
				where	a.nr_sequencia = x.nr_seq_funcao_grupo);
	end if;

end if;

begin
if	(ie_base_corp_w = 'S') and
	(:new.nr_seq_grupo_des > 0) then
	select	min(a.nr_seq_skill)
	into	nr_seq_skill_w
	from	funcao_grupo_des a
	where	a.nr_seq_grupo	= :new.nr_seq_grupo_des
	and	a.cd_funcao	= :new.cd_funcao;

	if	(nvl(nr_seq_skill_w,0) > 0) then

		select	max(ie_desenv)
		into	ie_desenv_w
		from	man_estagio_processo
		where	nr_sequencia    = :new.nr_seq_estagio;

		if	(ie_desenv_w = 'S') then

			delete from man_ordem_serv_skill
			where	nr_seq_ordem_serv = :new.nr_sequencia;

			insert into man_ordem_serv_skill
					(	nr_sequencia,
						nr_seq_skill,
						nr_seq_ordem_serv,
						nm_usuario,
						dt_atualizacao)
					values(	man_ordem_serv_skill_seq.nextval,
						nr_seq_skill_w,
						:new.nr_sequencia,
						'Tasy',
						sysdate);
		end if;
	end if;
end if;

exception when others then
	null;
end;

if	(:new.nr_seq_grupo_sup is null) and
	(:new.cd_funcao is not null) then
	select	min(b.nr_sequencia),
		max(b.nm_usuario_lider)
	into	:new.nr_seq_grupo_sup,
		nm_usuario_lider_sup_w
	from	grupo_suporte b,
		funcao_grupo_sup a
	where	a.nr_seq_grupo	= b.nr_sequencia
	and	a.cd_funcao	= :new.cd_funcao;
end if;

if	(ie_base_corp_w = 'S') and
	(nvl(Obter_Valor_Param_Usuario(299,137,Obter_Perfil_Ativo,:new.nm_usuario,0),'S')	= 'N') and
	(:new.ie_classificacao = 'D')	and
	(:new.NR_SEQ_ESTAGIO in (4,731,732,131,1051, 2112, 1532,1533,1534,1191,1274,2143)) and
	(:old.nr_seq_estagio in (2,3,31,41,71,121,141,151,152,201,231,232,311,791,811,861,1371,1431,1061,1071,1234,2113)) then
	wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173238);
end if;

if	(UPDATING) and
	(ie_base_corp_w = 'S') and
	(:new.ie_status_ordem = 3) and
	(:new.ie_status_ordem <> :old.ie_status_ordem) then
	begin
	:new.dt_fim_real := sysdate;

	if	(:old.ie_status_ordem <> :new.ie_status_ordem) and
		(:new.ie_tipo_ordem in (8,9)) then
		begin
		select	count(*)
		into	qt_existe_w
		from	man_ordem_serv_tecnico
		where	nr_seq_tipo = 88
		and	nr_seq_ordem_serv = :new.nr_sequencia;

		if	(qt_existe_w = 0) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(186637);
		end if;
		end;
	end if;
	end;
end if;

if	(:old.IE_STATUS_ORDEM = 3) and
	(:new.ie_status_ordem <> 3 ) and
	(ie_limpar_data_real_reab_w = 'S') then
	:new.dt_fim_real := null;
end if;

if	(inserting) and
	(ie_base_corp_w = 'S') and
	(:new.cd_funcao = -3000) then
	:new.nr_seq_estagio := 886;
end if;

if 	(:new.nr_seq_estagio = 231) and /* Aguardando Triagem*/
	(nvl(nm_usuario_lider_sup_w,'X') <> 'X') and
	(:new.ie_classificacao = 'D') and
	(:new.nm_usuario_exec is null) then
	:new.nm_usuario_exec := nm_usuario_lider_sup_w;
end if;

if	(inserting) and ((ie_base_corp_w = 'S') or (ie_base_wheb_w = 'S')) then
	begin
	if	(nvl(:new.nr_seq_severidade,0) = 0) then
		:new.nr_seq_severidade := null;
	end if;

	select	max(nr_seq_gerencia)
	into	nr_seq_gerencia_w
	from	grupo_desenvolvimento
	where	nr_sequencia	= :new.nr_seq_grupo_des;

	OPEN c03;
	LOOP
	FETCH C03 INTO
		ie_recebe_desenv_w,
		ie_sms_w,
		cd_pessoa_adic_w;
	EXIT WHEN C03%NOTFOUND;
	END LOOP;
	CLOSE C03;

	select	max(replace(replace(substr(elimina_caracteres_especiais(b.NR_DDI_CELULAR || b.NR_DDD_CELULAR || b.nr_telefone_celular),1,25),')',''),'(',''))
	into	nr_telefone_celular_w
	from	pessoa_fisica b,
		gerencia_wheb a
	where	b.cd_pessoa_fisica = a.cd_responsavel
	and	a.nr_sequencia = nr_seq_gerencia_w;

	/*Defeitos de HTML5 continuaro indo para o Desenvolvimento at estabilizao do produto*/
	if	((nvl(ie_recebe_desenv_w,'N') = 'S') or ((:NEW.ie_plataforma = 'H') and :NEW.ie_classificacao <> 'D')) and
		(:new.cd_funcao <> -3003) and
		(:new.cd_funcao <> -2999) and -- ICloud
		(:new.nr_seq_equipamento <> 2897) and
		(:new.ds_dano_breve <> obter_desc_expressao(348229)) then
		:new.nr_seq_estagio	:= 1051;	/*Aguardando triagem desenvolvimento*/
	end if;

	if	(nvl(ie_sms_w,'N') = 'S') and
		(nvl(nr_telefone_celular_w, 'X') <> 'X') then
		begin
		select	max(replace(replace(substr(elimina_caracteres_especiais(b.NR_DDI_CELULAR || b.NR_DDD_CELULAR || b.nr_telefone_celular),1,25),')',''),'(',''))
		into	nr_telefone_celular_adic_w
		from	pessoa_fisica b
		where	cd_pessoa_fisica = cd_pessoa_adic_w;

		if	(nvl(nr_telefone_celular_adic_w,'X') <> 'X') then

			nr_telefone_celular_adic_w := ';' || nr_telefone_celular_adic_w;

		end if;

		ds_mensagem_sms_w := 'Foi aberta uma nova ordem de servio N ' || :new.nr_sequencia || '.';

		enviar_sms_ordem_servico('SMS-OS', nr_telefone_celular_w || nr_telefone_celular_adic_w, ds_mensagem_sms_w, :new.nr_sequencia, 'Tasy');

		exception
		when others then
			null;
		end;
	end if;

	if	(:new.cd_funcao in (20000, 20001)) then
		:new.nr_seq_estagio := 231;
	end if;
end;
end if;

if	((inserting)
	and (ie_base_corp_w = 'S' or ie_base_wheb_w = 'S')) then
	if	(:new.nr_seq_severidade_wheb is null)	and
		(:new.nr_seq_severidade is not null)	and
		(:new.ie_origem_os = 1)	then
		begin
			:new.nr_seq_severidade_wheb := :new.nr_seq_severidade;

		exception
			when others then
				:new.nr_seq_severidade_wheb := null;
		end;
	end if;
end if;

if	(inserting) and		/*Solicitao OS330098 - OS's do HSC sero sempre direcionadas ao desenvolvimento e sempre tero o usurio da Bruna*/
	(ie_base_corp_w = 'S') and
	(:new.ie_classificacao = 'E') and
	(:new.nr_seq_localizacao = 15) and
	(:new.ds_dano_breve <> 'Migrao: necessidade de reviso dos projetos/componentes.') then
	begin
	:new.nr_seq_estagio	:= 1051;	/*Aguardando triagem desenvolvimento*/

	if	(:new.dt_ordem_servico < to_date(to_char(:new.dt_ordem_servico,'dd/mm/yyyy') || ' 08', 'dd/mm/yy hh24')) or
		(:new.dt_ordem_servico > to_date(to_char(:new.dt_ordem_servico,'dd/mm/yyyy') || ' 18', 'dd/mm/yy hh24')) then
		begin
		ds_mensagem_sms_w := 'Foi aberta uma nova ordem de servio de Erro N ' || :new.nr_sequencia || '.';
		enviar_sms_ordem_servico('SMS-OS', '4791916265', ds_mensagem_sms_w, :new.nr_sequencia, 'Tasy');
		exception
		when others then
			null;
		end;
	end if;
	end;
end if;

if	(ie_base_corp_w = 'S') and
	(:new.ie_classificacao = 'E') and
	(:new.ie_prioridade_sup is null) then /*Anderson  OS223881 - Conforme IT suporte*/
	:new.ie_prioridade_sup := 10;
end if;

if	( ie_base_corp_w = 'S' ) and
	( :new.ie_classificacao_cliente is null) and
	( :new.ie_classificacao is not null) then
	:new.ie_classificacao_cliente := :new.ie_classificacao;
end if;
/*Consistncia ao tirar a Ordem de Servio do estgio Tecnologia*/

if	( ie_base_corp_w = 'S' ) then
	if	( :old.nr_seq_estagio in(131,1532,1533,1534) ) and
		( :new.nr_seq_estagio not in (131,1532,1533,1534) ) then
		if	(:old.nr_seq_classif in (23,43)) then
			/*Tec -  Manuteno Componente - Estudo Viabilidade*/
			ds_retorno_w := verifica_historico_obrig(:new.nr_sequencia,25) || ds_enter_w;
			/*Tec -  Manuteno Componente - Desenvolvimento*/
			ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,26) || ds_enter_w;
			/*Tec -  Manuteno Componente - Teste da aplicao*/
			ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,27) || ds_enter_w;
		end if;
		/*Infraestrutura*/
		if	(:old.nr_seq_classif = 28) then
			open C02;
			loop
			fetch C02 into
				nr_seq_ativ_exec_w;
			exit when C02%notfound;
				begin
				case 	nr_seq_ativ_exec_w
					when	58 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,78) || ds_enter_w;
					when	115 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,81) || ds_enter_w;
					when	120 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,80) || ds_enter_w;
					when	130 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,84) || ds_enter_w;
					when	124 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,79) || ds_enter_w;
					when	131 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,82) || ds_enter_w;
					when	53 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,85) || ds_enter_w;
					when	53 	then
						ds_retorno_w := ds_retorno_w || verifica_historico_obrig(:new.nr_sequencia,86) || ds_enter_w;
				end case;
				end;
			end loop;
			close C02;
		end if;

		if	(ds_retorno_w is not null) and
			(replace(ds_retorno_w,ds_enter_w,'') = '') then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(229633,'DS_MENSAGEM='||ds_retorno_w);
			--' necessrio ter um histrico do tipo:'
		end	if;

	end if;

	if	(:new.nr_seq_estagio <> :old.nr_seq_estagio) and
		((:new.cd_funcao <> -3003 ) or
		(:new.cd_funcao is null)) then /*Atualizao de verso*/

		select	max(ie_tecnologia)
		into	ie_tecnologia_w
		from	man_estagio_processo
		where	ie_tecnologia = 'S'
		and	nr_sequencia = :new.nr_Seq_estagio;

		select 	max(ie_desenv)
		into	ie_desenv_w
		from	man_estagio_processo
		where 	nr_sequencia = :old.nr_seq_estagio
		and	ie_desenv = 'S'
		and	nvl(ie_tecnologia,'N') = 'N';

		/*Verificar se setor do usurio  desenvolvimento*/
		select	count(*)
		into	qt_reg_w
		from	usuario
		where	cd_setor_atendimento in (2,16)
		and	nm_usuario = :new.nm_usuario;

		select 	max(ie_tecnologia)
		into	ie_tecnologia_old_w
		from	man_estagio_processo
		where 	nr_sequencia = :old.nr_seq_estagio;

		if	( ie_tecnologia_w = 'S' ) and
			( ie_desenv_w = 'S') and
			( qt_reg_w > 0 ) and
			( ie_tecnologia_old_w <> 'S') then

			select 	count(*)
			into	qt_reg_w
			from	man_ordem_serv_tecnico a
			where	a.nr_seq_ordem_serv = :new.nr_sequencia
			and	a.nr_seq_tipo	= 76
			and	(exists (select 1
					from 	GRUPO_DESENVOLVIMENTO b
					where	b.nr_seq_gerencia <> 2
					and	a.nm_usuario_lib = b.nm_usuario_lider)
				or exists (
					select 1
					from	grupo_desenvolvimento b,
						grupo_Des_delegacao c
					where	b.nr_sequencia  = c.nr_seq_grupo_des
					and 	b.nr_seq_gerencia <> 2
					and	c.nm_usuario_delegacao = a.nm_usuario_lib
					and	a.dt_historico between c.dt_inicio_vigencia and nvl(c.dt_fim_vigencia,sysdate + 1))
				);

			if	(qt_reg_w = 0 ) then
				select	substr(obter_desc_expressao(cd_exp_tipo, ds_tipo),1,80)
				into	ds_tipo_w
				from	man_tipo_hist
				where	nr_sequencia = 76;
				wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173240,'DS_TIPO='||ds_tipo_w||';');
			end if;

		end if;

		select	max(ie_desenv)
		into	ie_desenv_new_w
		from	man_estagio_processo
		where	ie_desenv = 'S'
		and	nr_sequencia = :new.nr_Seq_estagio
		and	nvl(ie_tecnologia, 'N') = 'N';

		select 	max(ie_tecnologia)
		into	ie_tecnologia_old_w
		from	man_estagio_processo
		where 	nr_sequencia = :old.nr_seq_estagio
		and	ie_tecnologia = 'S';

		/*Verificar se setor do usurio  tecnologia*/
		select	count(*)
		into	qt_reg_w
		from	usuario
		where	cd_setor_atendimento in (7)
		and	nm_usuario = :new.nm_usuario;

		if	( ie_desenv_new_w = 'S' ) and
			( ie_tecnologia_old_w = 'S') and
			( qt_reg_w > 0 ) and
			( :new.ie_origem_os = 1 )	and
			( :new.cd_funcao <> -3001 )	then

			select 	count(*)
			into	qt_reg_w
			from	man_ordem_serv_tecnico a
			where	a.nr_seq_ordem_serv = :new.nr_sequencia
			and	a.nr_seq_tipo	= 76
			and	(exists (	select	1
							from 	grupo_desenvolvimento b
							where	b.nr_seq_gerencia = 2
							and		a.nm_usuario_lib = b.nm_usuario_lider)
				or exists (	select 1
							from	grupo_desenvolvimento b,
									grupo_Des_delegacao c
							where	b.nr_sequencia  = c.nr_seq_grupo_des
							and		b.nr_seq_gerencia = 2
							and		c.nm_usuario_delegacao = a.nm_usuario_lib
							and		a.dt_historico between c.dt_inicio_vigencia and nvl(c.dt_fim_vigencia,sysdate + 1))
				);

			if	(qt_reg_w = 0 ) then
				select	substr(obter_desc_expressao(cd_exp_tipo, ds_tipo),1,80)
				into	ds_tipo_w
				from	man_tipo_hist
				where	nr_sequencia = 76;
				wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(738422,'DS_TIPO='||ds_tipo_w||';');
			end if;

		end if;

	end if;

	if	( :new.nr_seq_estagio in(2,41,791)) and
		(:old.nr_seq_classif = 43) then

		if	(:new.ie_componente is null ) then
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173241);
		end if;

		/*Tec -  Manuteno Componente - Teste e Validao pelos Grupos do Desenvolvimento*/
		open C01;
		loop
		fetch C01 into
			ds_responsavel_teste_comp_w;
		exit when C01%notfound;
			begin
			ds_responsaveis_teste_comp_w := ds_responsaveis_teste_comp_w || chr(13) || chr(10) ||  ds_responsavel_teste_comp_w;
			end;
		end loop;
		close C01;
		if	(ds_responsaveis_teste_comp_w is not null ) then
			select	substr(obter_desc_expressao(cd_exp_tipo, ds_tipo),1,80)
			into	ds_tipo_w
			from	man_tipo_hist
			where	nr_sequencia = 30;
			wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(173242,'DS_TIPO='||ds_tipo_w||';DS_RESPONSAVEIS='||ds_responsaveis_teste_comp_w||';');
		end if;
	end if;
end if;

/* Francisco - 01/09/2010 - OS 244015
Tratei para sempre gravar o IE_ORIGEM_OS como "1 - Sistema Tasy" na base CORP
Seno no abre a funo nova para o densevolvimento */
if	(ie_base_corp_w = 'S') then
	/* Diether - 23/02/2011 - OS 293589
	Tratei para s mudar a origem da OS de Manuteno para Sistema Tasy se o estgio atual da OS for do desenvolvimento*/
	select	nvl(max(ie_desenv),'N')
	into	ie_estagio_atual_desen_w
	from	man_estagio_processo a
	where	a.nr_sequencia		= :new.nr_seq_estagio;

	if	(:new.ie_origem_os = 4) and
		(ie_estagio_atual_desen_w = 'S') then
		:new.ie_origem_os	:= 1;
	end if;

	if	(:new.nr_seq_causa_rnc is not null) then
		begin
			select	nvl(max(ie_abrangencia), 'N')
			into	ie_abrangencia_w
			from	qua_nao_conform_causa
			where	nr_sequencia = :new.nr_seq_causa_rnc;

			if	(ie_abrangencia_w = 'S') then
				if	(:new.dt_conclusao_desejada is not null) and
					(:new.dt_conclusao_desejada <> :old.dt_conclusao_desejada) then
					update	qua_nao_conform_causa
					set	dt_prevista 	= :new.dt_conclusao_desejada,
						dt_atualizacao	= sysdate,
						nm_usuario	= :new.nm_usuario
					where	nr_sequencia	= :new.nr_seq_causa_rnc;
				end if;

				if	(:new.dt_fim_real is not null) then
					update	qua_nao_conform_causa
					set	dt_realizacao 	= :new.dt_fim_real,
						dt_atualizacao	= sysdate,
						nm_usuario	= :new.nm_usuario
					where	nr_sequencia	= :new.nr_seq_causa_rnc;
				end if;
			end if;
		end;
	end if;
end if;

obter_param_usuario(299, 419, obter_perfil_Ativo, :new.nm_usuario,  cd_estabelecimento_w, ie_gerar_dt_fim_prev_sla_w);
obter_param_usuario(299, 529, obter_perfil_Ativo, :new.nm_usuario,  cd_estabelecimento_w, ie_gerar_dt_inicio_prev_sla_w);
obter_param_usuario(299, 57, obter_perfil_Ativo, :new.nm_usuario,  cd_estabelecimento_w, ie_utiliza_sla_w);

select	max(nr_sequencia),
	max(nr_seq_sla_regra)
into	nr_seq_sla_w,
	nr_seq_sla_regra_w
from	man_ordem_serv_sla
where	nr_seq_ordem	= :new.nr_sequencia;

if	(updating) and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio) then	/*Anderson 09/02/2011 - OS250441 - Se existir uma regra por estgio, atualiza para a nova regra*/
	begin

	select	man_obter_regra_sla(	cd_estabelecimento_w,
					:new.nm_usuario,:new.ie_prioridade, :new.ie_classificacao,
					:new.nr_seq_localizacao, :new.nr_grupo_trabalho, :new.dt_ordem_servico,
					:new.dt_inicio_real, :new.nr_seq_estagio, :new.nr_seq_equipamento, :new.nr_seq_classif, :new.ie_parado)
	into	nr_seq_sla_regra_ww
	from	dual;

	if	(	/*Padro para os clientes*/
		(nvl(nr_seq_sla_w,0) > 0) and
		(nvl(nr_seq_sla_regra_w,0) > 0) and
		(nvl(nr_seq_sla_regra_ww,0) > 0) and
		(nvl(nr_seq_sla_regra_w,0) <> nvl(nr_seq_sla_regra_ww,0))
		) OR
		(	/*Para o comercial, sempre que voltar de um estgio para um estgio com regra SLA, limpar a data real e comear a contar novamente*/
		(nvl(nr_seq_sla_w,0) > 0) and
		(ie_base_corp_w = 'S') and
		(nvl(nr_seq_sla_regra_ww,0) > 0) and
		(:new.nr_grupo_trabalho in (42,102))
		) then
		:new.dt_inicio_real := null;

		Man_atualizar_SLA_OS(nr_seq_sla_w, cd_estabelecimento_w,
				:new.nm_usuario,:new.ie_prioridade, :new.ie_classificacao,
				:new.nr_seq_localizacao, :new.nr_grupo_trabalho, :new.dt_ordem_servico,
				:new.dt_inicio_real, :new.nr_seq_estagio, :new.nr_seq_equipamento, :new.nr_seq_classif, :new.ie_parado);


		if	((nvl(ie_gerar_dt_fim_prev_sla_w,'N') = 'T') or (nvl(ie_gerar_dt_inicio_prev_sla_w,'N') = 'T')) then
			begin

			select	qt_min_termino,
					qt_min_inicio,
				ie_tempo
			into	qt_min_termino_w,
				qt_min_inicio_w,
				ie_tempo_w
			from	man_sla_regra
			where	nr_sequencia = nr_seq_sla_regra_ww;

			if	(nvl(ie_gerar_dt_fim_prev_sla_w,'N') = 'T') then
				if	(ie_tempo_w = 'COR') then
					:new.dt_fim_previsto	:= :new.dt_ordem_servico + (qt_min_termino_w / 1440);
				else
					:new.dt_fim_previsto	:= man_obter_hor_com(cd_estabelecimento_w, :new.dt_ordem_servico, qt_min_termino_w);
				end if;
			end if;

			if	(nvl(ie_gerar_dt_inicio_prev_sla_w,'N') = 'T') then
				if	(ie_tempo_w = 'COR') then
					:new.dt_inicio_previsto	:= :new.dt_ordem_servico + (qt_min_inicio_w / 1440);
				else
					:new.dt_inicio_previsto	:= man_obter_hor_com(cd_estabelecimento_w, :new.dt_ordem_servico, qt_min_inicio_w);
				end if;
			end if;

			end;
		end if;
	end if;
	end;
end if;

/*Buscar a regra que ser disparada na after, para j atualizar o fim previsto - Solicitao OS390954
Tratamento feito aqui pois no teria como atualizar a ordem de servio na after, mutanting*/
if	(inserting) or
	((nvl(nr_seq_sla_w,0) = 0) and
	((nvl(ie_gerar_dt_fim_prev_sla_w,'N') = 'T') or  (nvl(ie_gerar_dt_inicio_prev_sla_w,'N') = 'T'))) then
	begin

	if	(nvl(ie_utiliza_sla_w,'N') = 'S') and
		((nvl(ie_gerar_dt_fim_prev_sla_w,'N') <> 'N') or (nvl(ie_gerar_dt_inicio_prev_sla_w,'N') <> 'N')) then
		begin
		select	man_obter_regra_sla(	cd_estabelecimento_w,
						:new.nm_usuario,:new.ie_prioridade, :new.ie_classificacao,
						:new.nr_seq_localizacao, :new.nr_grupo_trabalho, :new.dt_ordem_servico,
						:new.dt_inicio_real, :new.nr_seq_estagio, :new.nr_seq_equipamento, :new.nr_seq_classif, :new.ie_parado)
		into	nr_seq_sla_regra_ww
		from	dual;

		if	(nr_seq_sla_regra_ww > 0) then
			begin
			select	qt_min_termino,
				qt_min_inicio,
				ie_tempo
			into	qt_min_termino_w,
				qt_min_inicio_w,
				ie_tempo_w
			from	man_sla_regra
			where	nr_sequencia = nr_seq_sla_regra_ww;

			if	(nvl(ie_gerar_dt_fim_prev_sla_w,'N') <> 'N') then
				if	(ie_tempo_w = 'COR') then
					:new.dt_fim_previsto	:= :new.dt_ordem_servico + (qt_min_termino_w / 1440);
				else
					:new.dt_fim_previsto	:= man_obter_hor_com(cd_estabelecimento_w, :new.dt_ordem_servico, qt_min_termino_w);
				end if;
			end if;

			if	(nvl(ie_gerar_dt_inicio_prev_sla_w,'N') <> 'N') then
				if	(ie_tempo_w = 'COR') then
					:new.dt_inicio_previsto	:= :new.dt_ordem_servico + (qt_min_inicio_w / 1440);
				else
					:new.dt_inicio_previsto	:= man_obter_hor_com(cd_estabelecimento_w, :new.dt_ordem_servico, qt_min_inicio_w);
				end if;
			end if;

			end;
		end if;
		end;
	end if;
	end;
end if;

if	(:new.cd_centro_custo_os is null) and
	(:new.nr_seq_localizacao is not null) then
	select	max(a.cd_centro_custo)
	into	:new.cd_centro_custo_os
	from	setor_atendimento a,
		man_localizacao b
	where	a.cd_setor_atendimento 	= b.cd_setor
	and	b.nr_sequencia 		= :new.nr_seq_localizacao;
end if;

if	(updating) and
	(:old.nr_seq_proj_cron_etapa is not null) and
	(:new.nr_seq_estagio in (2,9,1511)) then

	update	proj_cron_etapa
	set	ie_status_etapa = '4'
	where	nr_sequencia = :old.nr_seq_proj_cron_etapa;

	select	count(*)
	into	qt_reg_w
	from	proj_cron_etapa c
	where	c.ie_status_etapa not in ('4','1')
	and	c.nr_seq_cronograma = (	select	x.nr_seq_cronograma
					from	proj_cron_etapa x
					where	x.nr_sequencia = :old.nr_seq_proj_cron_etapa);

	if	(qt_reg_w = 0) then
		atualizar_cronograma_npi(:old.nr_seq_proj_cron_etapa,:new.nm_usuario);
	end if;
end if;

if	(updating) and
	(:old.dt_teste_negocio is not null) and
	(:old.nr_seq_estagio in (2,1511)) and /*Cliente Teste*/
	(:new.nr_seq_estagio = 4) and /*Desenv pendente analise */
	(:new.ie_classificacao in ('T','S')) then /*Solicitao / Sugesto*/
	:new.dt_teste_negocio := sysdate;
end if;

if	(updating) and
	(ie_base_corp_w = 'S') and
	(:new.nr_seq_estagio <> :old.nr_seq_estagio) then

	if	(:new.nr_seq_estagio = 9) and
		((:new.dt_fim_real is null) or (:new.ie_status_ordem <> '3')) then
		wheb_mensagem_pck.EXIBIR_MENSAGEM_ABORT(366288);
	end if;

	select	nvl(max(nr_sequencia),0)
	into	nr_seq_solic_sd_w
	from	com_solic_sd
	where	nr_ordem_servico = :new.nr_sequencia;

	if	(nr_seq_solic_sd_w > 0) then

		select	max(ie_acao),
			max(nr_seq_mot_canc_sd)
		into	ie_acao_solic_w,
			nr_seq_mot_canc_solic_w
		from	com_acao_encerrar_os
		where	nr_seq_estagio = :new.nr_seq_estagio;

		if	(ie_acao_solic_w = 'C') then
			com_atualizar_status_sd_js(ie_acao_solic_w,:new.nr_sequencia, nr_seq_mot_canc_solic_w, obter_texto_dic_objeto(326288, wheb_usuario_pck.get_nr_seq_idioma, null), :new.nm_usuario, 'N');

		elsif	(ie_acao_solic_w = 'R') then
			com_atualizar_status_sd_js(ie_acao_solic_w,:new.nr_sequencia, null, null, :new.nm_usuario, 'N');
		end if;
	end if;
end if;

man_ordem_servico_validation(case inserting when true then 'I' else 'U' end, :new.nm_usuario, :old.nm_usuario, :new.nr_sequencia, :old.nr_sequencia, :new.nr_seq_estagio, :old.nr_seq_estagio,
:new.nr_seq_grupo_des, :old.nr_seq_grupo_des, :new.nr_seq_localizacao, :old.nr_seq_localizacao, :new.ie_classificacao, :old.ie_classificacao,
:new.cd_funcao, :old.cd_funcao, :new.ie_origem_os, :old.ie_origem_os, :new.ie_plataforma, :old.ie_plataforma);

if ((ie_base_corp_w = 'S') and (:new.nm_usuario = 'WebService') and (:new.nr_seq_estagio not in (1051, 1731)) and (:old.nr_seq_estagio IN (2, 41, 261))) then
	select	max(ie_tecnologia),
			max(ie_desenv)
	into	ie_tecnologia_w,
			ie_desenv_w
	from	man_estagio_processo
	where	nr_sequencia = :new.nr_seq_estagio;

	if (ie_tecnologia_w = 'S') then
		:new.nr_seq_estagio := 1731;
	end if;

	if (ie_desenv_w = 'S') then
		:new.nr_seq_estagio := 1051;
	end if;

end if;

if ((ie_base_corp_w = 'S') and (:new.ie_origem_os = 1) and (:new.dt_inicio_real is null) and (:new.ie_status_ordem = 2)) then
	:new.dt_inicio_real := sysdate;
end if;

<<Final>>

qt_reg_w	:= 0;
END;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_ATUAL" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_BINSERT" 
BEFORE INSERT OR UPDATE ON man_ordem_servico
FOR EACH ROW
DECLARE

nm_user_w			Varchar2(50);
ds_versao_w			Varchar2(50);

BEGIN

if	(:new.nr_seq_localizacao is not null) and
	((:new.nr_versao_cliente_abertura is null) or
	 (nvl(:new.nr_seq_localizacao,0) <> nvl(:old.nr_seq_localizacao,0))) then

	select	username
	into	nm_user_w
	from	user_users;

	if	(nm_user_w = 'CORP') then
		select	max(b.cd_versao || '.' ||b.cd_build)
		into	ds_versao_w
		from	man_localizacao_versao a,
				versao_alteracao b
		where	a.nr_seq_localizacao	= :new.nr_seq_localizacao
		and		a.nr_seq_versao_alteracao = b.nr_sequencia
		and		a.dt_atualizacao_versao	= (	select	max(dt_atualizacao_versao)
											from	man_localizacao_versao x
											where	x.nr_sequencia = a.nr_sequencia);

		if	(ds_versao_w is not null) then
			:new.nr_versao_cliente_abertura	:= ds_versao_w;
		end if;
	end if;
end if;

END;

/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_BINSERT" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_BEFORE_DEL" 
BEFORE DELETE ON man_ordem_servico
FOR EACH ROW
DECLARE

nm_user_w		varchar2(10);

BEGIN
if	(wheb_usuario_pck.get_ie_executar_trigger	= 'N')  then
	goto Final;
end if;

select	substr(user,1,4)
into	nm_user_w
from	dual;

if	(nm_user_w = 'CORP') then
	/*(-20011,'Ordem de servio no pode ser excluda. Se a mesma no  mais necessria, deve ser encerrada.#@#@');*/
	wheb_mensagem_pck.exibir_mensagem_abort(263159);
end if;
<<Final>>
null;

END;

/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_BEFORE_DEL" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_TP" after update on MAN_ORDEM_SERVICO FOR EACH ROW  DECLARE nr_seq_w number(10); ds_s_w   varchar2(50); ds_c_w   varchar2(500); ds_w	   varchar2(500); ie_log_w varchar2(1); begin begin ds_s_w := to_char(:old.NR_SEQUENCIA);  ds_c_w:=null;gravar_log_alteracao(substr(:old.NR_SEQ_TIPO_SOLUCAO,1,4000),substr(:new.NR_SEQ_TIPO_SOLUCAO,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_TIPO_SOLUCAO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.CD_VERSAO_ENTREGA,1,4000),substr(:new.CD_VERSAO_ENTREGA,1,4000),:new.nm_usuario,nr_seq_w,'CD_VERSAO_ENTREGA',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_GRUPO_PLANEJ,1,4000),substr(:new.NR_GRUPO_PLANEJ,1,4000),:new.nm_usuario,nr_seq_w,'NR_GRUPO_PLANEJ',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_EQUIPAMENTO,1,4000),substr(:new.NR_SEQ_EQUIPAMENTO,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_EQUIPAMENTO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_INICIO_PREVISTO,1,4000),substr(:new.DT_INICIO_PREVISTO,1,4000),:new.nm_usuario,nr_seq_w,'DT_INICIO_PREVISTO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.IE_TIPO_ORDEM,1,4000),substr(:new.IE_TIPO_ORDEM,1,4000),:new.nm_usuario,nr_seq_w,'IE_TIPO_ORDEM',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NM_USUARIO_EXEC,1,4000),substr(:new.NM_USUARIO_EXEC,1,4000),:new.nm_usuario,nr_seq_w,'NM_USUARIO_EXEC',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_PLANEJ,1,4000),substr(:new.NR_SEQ_PLANEJ,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_PLANEJ',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_LOCALIZACAO,1,4000),substr(:new.NR_SEQ_LOCALIZACAO,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_LOCALIZACAO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.CD_PESSOA_SOLICITANTE,1,4000),substr(:new.CD_PESSOA_SOLICITANTE,1,4000),:new.nm_usuario,nr_seq_w,'CD_PESSOA_SOLICITANTE',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_ORDEM_SERVICO,1,4000),substr(:new.DT_ORDEM_SERVICO,1,4000),:new.nm_usuario,nr_seq_w,'DT_ORDEM_SERVICO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.IE_PRIORIDADE,1,4000),substr(:new.IE_PRIORIDADE,1,4000),:new.nm_usuario,nr_seq_w,'IE_PRIORIDADE',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.IE_PARADO,1,4000),substr(:new.IE_PARADO,1,4000),:new.nm_usuario,nr_seq_w,'IE_PARADO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DS_DANO_BREVE,1,4000),substr(:new.DS_DANO_BREVE,1,4000),:new.nm_usuario,nr_seq_w,'DS_DANO_BREVE',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_INICIO_DESEJADO,1,4000),substr(:new.DT_INICIO_DESEJADO,1,4000),:new.nm_usuario,nr_seq_w,'DT_INICIO_DESEJADO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DS_DANO,1,4000),substr(:new.DS_DANO,1,4000),:new.nm_usuario,nr_seq_w,'DS_DANO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_FIM_PREVISTO,1,4000),substr(:new.DT_FIM_PREVISTO,1,4000),:new.nm_usuario,nr_seq_w,'DT_FIM_PREVISTO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_INICIO_REAL,1,4000),substr(:new.DT_INICIO_REAL,1,4000),:new.nm_usuario,nr_seq_w,'DT_INICIO_REAL',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.IE_STATUS_ORDEM,1,4000),substr(:new.IE_STATUS_ORDEM,1,4000),:new.nm_usuario,nr_seq_w,'IE_STATUS_ORDEM',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_GRUPO_TRABALHO,1,4000),substr(:new.NR_GRUPO_TRABALHO,1,4000),:new.nm_usuario,nr_seq_w,'NR_GRUPO_TRABALHO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_GRUPO_DES,1,4000),substr(:new.NR_SEQ_GRUPO_DES,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_GRUPO_DES',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_GRUPO_SUP,1,4000),substr(:new.NR_SEQ_GRUPO_SUP,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_GRUPO_SUP',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_CONCLUSAO_DESEJADA,1,4000),substr(:new.DT_CONCLUSAO_DESEJADA,1,4000),:new.nm_usuario,nr_seq_w,'DT_CONCLUSAO_DESEJADA',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_FIM_REAL,1,4000),substr(:new.DT_FIM_REAL,1,4000),:new.nm_usuario,nr_seq_w,'DT_FIM_REAL',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.CD_FUNCAO,1,4000),substr(:new.CD_FUNCAO,1,4000),:new.nm_usuario,nr_seq_w,'CD_FUNCAO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.IE_CLASSIFICACAO,1,4000),substr(:new.IE_CLASSIFICACAO,1,4000),:new.nm_usuario,nr_seq_w,'IE_CLASSIFICACAO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_ORIGEM,1,4000),substr(:new.NR_SEQ_ORIGEM,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_ORIGEM',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_ORIGEM_DANO,1,4000),substr(:new.NR_SEQ_ORIGEM_DANO,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_ORIGEM_DANO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_CLASSIF,1,4000),substr(:new.NR_SEQ_CLASSIF,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_CLASSIF',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.IE_GRAU_SATISFACAO,1,4000),substr(:new.IE_GRAU_SATISFACAO,1,4000),:new.nm_usuario,nr_seq_w,'IE_GRAU_SATISFACAO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_CAUSA_DANO,1,4000),substr(:new.NR_SEQ_CAUSA_DANO,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_CAUSA_DANO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.NR_SEQ_ESTAGIO,1,4000),substr(:new.NR_SEQ_ESTAGIO,1,4000),:new.nm_usuario,nr_seq_w,'NR_SEQ_ESTAGIO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DT_FIM_GARANTIA,1,4000),substr(:new.DT_FIM_GARANTIA,1,4000),:new.nm_usuario,nr_seq_w,'DT_FIM_GARANTIA',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w); gravar_log_alteracao(substr(:old.DS_SOLUCAO,1,4000),substr(:new.DS_SOLUCAO,1,4000),:new.nm_usuario,nr_seq_w,'DS_SOLUCAO',ie_log_w,ds_w,'MAN_ORDEM_SERVICO',ds_s_w,ds_c_w);   exception when others then ds_w:= '1'; end; end;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_TP" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_UPSUP" 
before update on MAN_ORDEM_SERVICO
for each row

declare
ds_log_w	VARCHAR2(4000);
nm_user_w	varchar2(50);
/*Trigger criada exclusivamente para o setor de Suporte*/

begin

select	username
into	nm_user_w
from	user_users;

if	(lower(nm_user_w)  = 'corp') and
	(nvl(:old.IE_GRAU_SATISFACAO,'xpto') <> 'xpto') and
	(nvl(:new.IE_GRAU_SATISFACAO,'xpto') <> nvl(:old.IE_GRAU_SATISFACAO,'xpto')) and
	(nvl(:old.IE_GRAU_SATISFACAO,'xpto') <> 'xpto')	then

		ds_log_w := 'OS: '||:new.nr_sequencia||obter_desc_expressao(313421)/*' Valor antigo: '*/||': '||:old.IE_GRAU_SATISFACAO||'-'||substr(obter_valor_dominio(1197, :old.IE_GRAU_SATISFACAO),1,20)||
					obter_desc_expressao(301455)/*' Valor novo: '*/||': '||:new.IE_GRAU_SATISFACAO||'-'||substr(obter_valor_dominio(1197, :new.IE_GRAU_SATISFACAO),1,20);

		insert into log_mov(dt_atualizacao, nm_usuario, ds_log, cd_log) values (sysdate, wheb_usuario_pck.get_nm_usuario, ds_log_w, 280691);

end if;


end;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_UPSUP" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_AUTO_ENCER" 
before update on man_ordem_servico
for each row

declare
qt_existe_orc_w				number(10,0);
qt_reg_w				number(10,0);
qt_inconsist_teste_w			number(10,0);
nm_usuario_manutencao_w			varchar2(15);
nr_seq_tipo_hist_w			number(10,0);

procedure encerrar_ordem_servico is
begin
if	(:new.nr_seq_grupo_des is not null) then
	select	count(1)
	into	qt_existe_orc_w
	from	man_ordem_servico_orc
	where	nr_seq_ordem	= :new.nr_sequencia
	and	dt_aprovacao is null
	and	dt_reprovacao is null
	and	rownum	= 1;

	if	(qt_existe_orc_w = 0) then
		:new.dt_inicio_real	:= :new.dt_inicio_previsto;
		:new.dt_fim_real	:= sysdate;
		:new.nr_seq_estagio	:= 9;
		:new.ie_status_ordem	:= 3;
		:new.nm_usuario		:= 'WebService';
		:new.dt_atualizacao	:= sysdate;
		:new.nm_usuario_encer	:= 'WebService';

		select	b.nm_usuario_manutencao
		into	nm_usuario_manutencao_w
		from	grupo_desenvolvimento b
		where	b.nr_sequencia	= :new.nr_seq_grupo_des;

		select	count(1)
		into	qt_reg_w
		from	man_ordem_servico_exec
		where	nr_seq_ordem	= :new.nr_sequencia
		and	nm_usuario_exec	= nm_usuario_manutencao_w
		and 	rownum		= 1;

		if	(qt_reg_w > 0) then
			update	man_ordem_servico_exec a
			set	a.dt_fim_execucao	= null
			where	a.nr_seq_ordem		= :new.nr_sequencia
			and	a.nm_usuario_exec	= nm_usuario_manutencao_w;
		else
			if	(nvl(nm_usuario_manutencao_w,'X') <> 'X') then
				insert into man_ordem_servico_exec
					(	nr_sequencia,
						nr_seq_ordem,
						dt_atualizacao,
						nm_usuario,
						nm_usuario_exec,
						qt_min_prev,
						nr_seq_tipo_exec,
						dt_atualizacao_nrec,
						nm_usuario_nrec)
				values	(	man_ordem_servico_exec_seq.nextval,
						:new.nr_sequencia,
						sysdate,
						:new.nm_usuario,
						nm_usuario_manutencao_w,
						15,
						1,
						sysdate,
						:new.nm_usuario);
			end if;
		end if;
	end if;
end if;
end;

begin
if	(user = 'CORP') then
	if	(:new.nr_seq_estagio <> :old.nr_seq_estagio) and
		(:new.nr_seq_estagio = 511) and --Encerramento solicitado pelo cliente
		(:new.ie_classificacao in ('T','S','D','E')) and --Solicitao / Sugesto
		(nvl(:new.ie_grau_satisfacao,'N') in ('O','B','E','N')) and
		(:new.nr_seq_tipo_solucao is not null) then
		begin

			if	(:old.ie_status_ordem = 3) then
				:new.ie_status_ordem := 2;
			end if;

			if	(:new.ie_classificacao = 'D') then
				encerrar_ordem_servico;
			else
				select	nvl(max(nr_seq_tipo_hist), 0)
				into	nr_seq_tipo_hist_w
				from	man_classificacao
				where	nr_sequencia = :new.nr_seq_classif;

				select	count(*)
				into	qt_inconsist_teste_w
				from	(	select 	1 -- Consistncia do histrico com a sequncia do NR_SEQ_TIPO_HIST_W
						from 	dual
						where 	nr_seq_tipo_hist_w > 0
						and	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_ordem_serv = :new.nr_sequencia
									and	x.nr_seq_tipo = nr_seq_tipo_hist_w
								)
						union all
						select	1 -- Histrico - Teste do analista
						from	dual
						where	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 31
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
									and	(
											(	x.dt_liberacao >= (	select	max(e.dt_atualizacao)
															from	man_ordem_serv_estagio e
															where	e.nr_seq_ordem = x.nr_seq_ordem_serv
															and	e.nr_seq_estagio in (2, 791)
														)
											)
										or 	(	not exists (	select	1
													from	man_ordem_serv_estagio e
													where	e.nr_seq_ordem = x.nr_seq_ordem_serv
													and	e.nr_seq_estagio in (2, 791)
													)
											)
										)
								)
						union all
						select	1 -- Histrico - Teste do analista (Quando a OS  reprogramada)
						from	dual
						where	:new.nr_seq_estagio <> 2
						and 	:new.ie_resp_teste_reprog = 'A'
						union all
						select	1 -- Histrico - Teste
						from	dual
						where	:new.ie_resp_teste = 'P'
						and	nr_seq_tipo_hist_w = 0
						and	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 12
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
									and	(
											(	x.dt_liberacao >= (	select	max(e.dt_atualizacao)
															from	man_ordem_serv_estagio e
															where	e.nr_seq_ordem = x.nr_seq_ordem_serv
															and e.nr_seq_estagio in (2, 791)
														)
											)
										or	(	not exists (	select	1
													from	man_ordem_serv_estagio e
													where	e.nr_seq_ordem = x.nr_seq_ordem_serv
													and	e.nr_seq_estagio in (2, 791)
												)
											)
										)
								)
						union all
						select	1 -- Histrico - Teste
						from	dual
						where	nr_seq_tipo_hist_w = 0
						and	:new.ie_classificacao <> 'D'
						and	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 12
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
									and	(
											(	x.dt_liberacao >= (	select	max(e.dt_atualizacao)
															from	man_ordem_serv_estagio e
															where	e.nr_seq_ordem = x.nr_seq_ordem_serv
															and e.nr_seq_estagio in (2, 791)
														)
											)
										or	(	not exists (	select	1
														from	man_ordem_serv_estagio e
														where	e.nr_seq_ordem = x.nr_seq_ordem_serv
														and e.nr_seq_estagio in (2, 791)
													)
											)
										)
								)
						union all
						select	1 -- Histrico - Teste do analista
						from	dual
						where	:new.ie_classificacao <> 'D'
						and	:new.nr_seq_complex = 1
						and	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 31
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
									and	(
											(	x.dt_liberacao >= (	select	max(e.dt_atualizacao)
															from	man_ordem_serv_estagio e
															where	e.nr_seq_ordem = x.nr_seq_ordem_serv
															and	e.nr_seq_estagio in (2, 791)
														)
											)
										or	(	not exists (	select	1
														from	man_ordem_serv_estagio e
														where	e.nr_seq_ordem = x.nr_seq_ordem_serv
														and	e.nr_seq_estagio in (2, 791)
													)
											)
										)
								)
						union all
						select	1 -- Histrico - Teste de performance do analista
						from	dual
						where	:new.ie_classificacao <> 'D'
						and	:new.ie_teste_performance = 'PA'
						and	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 37
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
								)
						union all
						select	1 -- Histrico - Teste de performance do programador
						from	dual
						where	:new.ie_classificacao <> 'D'
						and	:new.ie_teste_performance in ('PA', 'SP')
						and	:new.nr_seq_estagio <> 2
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 38
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
								)
						union all
						select	1 -- Exigir teste analista negcio
						from	dual
						where	:new.nr_seq_estagio <> 2
						and	:new.dt_teste_negocio is not null
						and not exists (	select	1
									from	man_ordem_serv_tecnico x
									where	x.nr_seq_tipo = 109
									and	x.nr_seq_ordem_serv = :new.nr_sequencia
								)
				) x;

				if	(qt_inconsist_teste_w = 0) then
					encerrar_ordem_servico;
				end if;
			end if;
		end;
	end if;
end if;
end;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_AUTO_ENCER" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERV_AFTER_ESTAGIO" 
after insert or update of nr_seq_estagio on man_ordem_servico
for each row

declare
dt_estagio_anterior_w		date;
nr_seq_gerencia_w		number(10);
cd_pessoa_gerente_w		varchar2(10);
qt_minuto_pre_analise_w		number(15);
ie_origem_alteracao_w		varchar2(1);

begin

if	(user = 'CORP') or
	(obter_se_base_wheb = 'S') then

	if	(:old.nr_seq_estagio is null) and
		(:new.nr_seq_estagio in (1051,231,1731)) then --Desenv aguardando triagem, Aguardando triagem, Tec aguardando triagem

		if	(:new.nr_seq_grupo_des is not null) then

			select	max(nr_seq_gerencia)
			into	nr_seq_gerencia_w
			from	grupo_desenvolvimento
			where	nr_sequencia = :new.nr_seq_grupo_des;

		elsif	(:new.nr_seq_grupo_sup is not null) then

			select	max(nr_seq_gerencia_sup)
			into	nr_seq_gerencia_w
			from	grupo_suporte
			where	nr_sequencia = :new.nr_seq_grupo_sup;

		end if;

		select	substr(obter_responsavel_gerencia(nr_seq_gerencia_w), 1, 10),
			decode(upper(:new.nm_usuario), 'WEBSERVICE', 'E', 'WEBSERVICE 2', 'E', 'WEB', 'E', 'WEBSERVER', 'E', 'I')
		into	cd_pessoa_gerente_w,
			ie_origem_alteracao_w
		from	dual;

		insert into man_ordem_serv_log_triagem (
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_ordem_serv,
			nr_seq_localizacao,
			nr_seq_grupo_des,
			nr_seq_grupo_sup,
			nr_seq_gerencia,
			cd_pessoa_gerente,
			nr_seq_estagio_anterior,
			dt_estagio_anterior,
			nr_seq_estagio_atual,
			dt_estagio_atual,
			ie_classificacao_cliente,
			ie_classificacao_philips,
			ie_prioridade_cliente,
			ie_prioridade_philips,
			qt_minuto_pre_analise,
			dt_ordem_servico,
			dt_inicio_real,
			ie_origem_alteracao)
		values (	man_ordem_serv_log_triagem_seq.nextval,
			sysdate,
			:new.nm_usuario,
			sysdate,
			:new.nm_usuario,
			:new.nr_sequencia,
			:new.nr_seq_localizacao,
			:new.nr_seq_grupo_des,
			:new.nr_seq_grupo_sup,
			nr_seq_gerencia_w,
			cd_pessoa_gerente_w,
			null,
			null,
			:new.nr_seq_estagio,
			sysdate,
			:new.ie_classificacao_cliente,
			:new.ie_classificacao,
			:new.ie_prioridade_cliente,
			:new.ie_prioridade,
			0,
			:new.dt_ordem_servico,
			sysdate,
			ie_origem_alteracao_w);

	elsif	(:old.nr_seq_estagio in (1051,231,1731)) and --Desenv aguardando triagem, Aguardando triagem, Tec aguardando triagem
		(:new.nr_seq_estagio is not null) and
		(:new.nr_seq_estagio <> :old.nr_seq_estagio) then

		select	max(dt_atualizacao)
		into	dt_estagio_anterior_w
		from	man_ordem_serv_estagio
		where	nr_seq_ordem = :new.nr_sequencia
		and	nr_seq_estagio = :old.nr_seq_estagio;

		if	(:old.nr_seq_grupo_des is not null) then

			select	max(nr_seq_gerencia)
			into	nr_seq_gerencia_w
			from	grupo_desenvolvimento
			where	nr_sequencia = :old.nr_seq_grupo_des;

		elsif	(:old.nr_seq_grupo_sup is not null) then

			select	max(nr_seq_gerencia_sup)
			into	nr_seq_gerencia_w
			from	grupo_suporte
			where	nr_sequencia = :old.nr_seq_grupo_sup;

		end if;

		select	substr(obter_responsavel_gerencia(nr_seq_gerencia_w), 1, 10),
			decode(upper(:new.nm_usuario), 'WEBSERVICE', 'E', 'WEBSERVICE 2', 'E', 'WEB', 'E', 'WEBSERVER', 'E', 'I')
		into	cd_pessoa_gerente_w,
			ie_origem_alteracao_w
		from	dual;

		if	(trunc(dt_estagio_anterior_w, 'dd') = trunc(sysdate, 'dd')) or
			(obter_cod_dia_semana(sysdate) in (7, 1) or
			 obter_se_feriado(1, sysdate) > 0) then
			select	(sysdate - dt_estagio_anterior_w) * 1440
			into	qt_minuto_pre_analise_w
			from	dual;
		else
			select	man_obter_min_com(1, dt_estagio_anterior_w, sysdate)
			into	qt_minuto_pre_analise_w
			from	dual;
		end if;

		insert into man_ordem_serv_log_triagem (
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_ordem_serv,
			nr_seq_localizacao,
			nr_seq_grupo_des,
			nr_seq_grupo_sup,
			nr_seq_gerencia,
			cd_pessoa_gerente,
			nr_seq_estagio_anterior,
			dt_estagio_anterior,
			nr_seq_estagio_atual,
			dt_estagio_atual,
			ie_classificacao_cliente,
			ie_classificacao_philips,
			ie_prioridade_cliente,
			ie_prioridade_philips,
			qt_minuto_pre_analise,
			dt_ordem_servico,
			dt_inicio_real,
			ie_origem_alteracao)
		values (	man_ordem_serv_log_triagem_seq.nextval,
			sysdate,
			:new.nm_usuario,
			sysdate,
			:new.nm_usuario,
			:new.nr_sequencia,
			:new.nr_seq_localizacao,
			:old.nr_seq_grupo_des,
			:old.nr_seq_grupo_sup,
			nr_seq_gerencia_w,
			cd_pessoa_gerente_w,
			:old.nr_seq_estagio,
			dt_estagio_anterior_w,
			:new.nr_seq_estagio,
			sysdate,
			:old.ie_classificacao_cliente,
			:old.ie_classificacao,
			:old.ie_prioridade_cliente,
			:old.ie_prioridade,
			nvl(qt_minuto_pre_analise_w,0),
			:new.dt_ordem_servico,
			sysdate,
			ie_origem_alteracao_w);
	end if;
end if;

end;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERV_AFTER_ESTAGIO" ENABLE;

  CREATE OR REPLACE TRIGGER "TASY"."MAN_ORDEM_SERVICO_AFTER" 
after insert or update on man_ordem_servico
for each row
declare

nm_user_w			varchar2(50);
dt_inicio_w			date;
dt_termino_w			date;
nr_sequencia_w			number(15,0);
cd_estabelecimento_w		number(15,0);
vl_parametro_w			varchar2(255);
qt_reg_w			number(1);
ie_atualiza_estagio_ativ_w	varchar2(01) := 'N';
qt_minuto_w			number(15,0);
nr_seq_estagio_w		number(10,0);
ie_gerar_aval_efic_w		varchar2(1) := 'N';
nr_seq_agenda_w			number(10);
nr_seq_gerencia_w		number(10);
ie_tempo_w			man_ordem_serv_sla.ie_tempo%type;
nr_seq_estagio_sla_w		man_ordem_serv_sla.nr_seq_estagio%type;
dt_estagio_w			date;
cd_estabelecimento_ww		man_localizacao.cd_estabelecimento%type;
dt_inicio_ww			date;
qt_min_real_os_w		man_ordem_serv_sla.qt_min_real_os%type;
dt_ordem_w			date;
dt_anterior_w			date;
ie_aguarda_cliente_ww		varchar2(255);
ie_aguarda_cliente_w		varchar2(255);
dt_atualizacao_w		date;
qt_min_w			Number(15);
cd_setor_usuario_w		number(15,0);
nm_usuario_resp_w		varchar2(15);
qtd_registro_usuario_setor_w	number(10);

Cursor C01 is
	select a.dt_atualizacao, b.ie_aguarda_cliente
	from	man_estagio_processo b,
		man_ordem_serv_estagio a
	where	a.nr_seq_ordem		= :new.nr_sequencia
	and	a.nr_seq_estagio	= b.nr_sequencia
	union all
	select nvl(:new.dt_fim_real,sysdate),
		b.ie_aguarda_cliente
	from	man_estagio_processo b
	where	b.nr_sequencia		= :new.nr_sequencia
	order by 1;

begin

if	(wheb_usuario_pck.get_ie_executar_trigger	= 'N')  then
	goto final;
end if;

if	(:new.nr_seq_estagio <> :old.nr_seq_estagio) or
	(:old.nr_seq_estagio is null) and
	(:new.nr_seq_estagio is not null) then
	begin
		insert into man_ordem_serv_estagio(
			nr_sequencia,
			nr_seq_ordem,
			dt_atualizacao,
			nm_usuario,
			nr_seq_estagio,
			ie_tipo_customizacao_os,
			nr_seq_grupo_planej)
		values(	man_ordem_serv_estagio_seq.nextval,
			:new.nr_sequencia,
			sysdate,
			nvl(wheb_usuario_pck.get_nm_usuario, :new.nm_usuario),
			:new.nr_seq_estagio,
			:new.ie_tipo_customizacao_os,
			:new.nr_grupo_planej);
	exception
	when others then
		--Tratamento ao disparar erro de FK
		if (sqlcode = -02291) then
			/* Estgio de encerramento de Ordem de servio Philips no encontrado. Favor verificar cadastros  */
			wheb_mensagem_pck.exibir_mensagem_abort(852352);
		else
			raise;
		end if;

	end;

	/*inicio alterao os243922*/
	obter_param_usuario(299, 288, obter_perfil_ativo, :new.nm_usuario,  wheb_usuario_pck.get_cd_estabelecimento, ie_atualiza_estagio_ativ_w);

	if	(nvl(ie_atualiza_estagio_ativ_w,'N') = 'S') then
		begin
		if	(:old.nr_seq_estagio is not null) then
			select	max(nr_sequencia)
			into	nr_seq_estagio_w
			from	man_ordem_serv_estagio
			where	nr_seq_ordem = :new.nr_sequencia
			and	nr_seq_estagio= :old.nr_seq_estagio;

			qt_minuto_w	:= nvl(trunc(man_obter_tempo_estagio(nr_seq_estagio_w,:new.nr_sequencia,'M')),0);

			insert into man_os_estagio_ativ(	nr_sequencia,
							nr_seq_ordem_servico,
							dt_atualizacao,
							nm_usuario,
							dt_atualizacao_nrec,
							nm_usuario_nrec,
							qt_minuto,
							nr_seq_estagio,
							nr_seq_os_ativ)
						values(	man_os_estagio_ativ_seq.nextval,
							:new.nr_sequencia,
							sysdate,
							:new.nm_usuario,
							sysdate,
							:new.nm_usuario,
							nvl(qt_minuto_w,0),
							:old.nr_seq_estagio,
							0);
		end if;
		end;
	end if;		/*fim alterao os243922*/
end if;

if	(:new.nr_seq_tipo_ordem <> :old.nr_seq_tipo_ordem) or
	(:old.nr_seq_tipo_ordem is null) and
	(:new.nr_seq_tipo_ordem is not null) then
	insert into man_ordem_serv_hist_tp_cli(	nr_sequencia,
					nr_seq_ordem_servico,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_seq_tipo)
				values(	man_ordem_serv_hist_tp_cli_seq.nextval,
					:new.nr_sequencia,
					sysdate,
					:new.nm_usuario,
					sysdate,
					:new.nm_usuario,
					:new.nr_seq_tipo_ordem);
end if;

if	(:new.nr_seq_localizacao is not null) then
	begin
	select	cd_estabelecimento
	into	cd_estabelecimento_w
	from	man_localizacao
	where	nr_sequencia		= :new.nr_seq_localizacao;
	exception
	when others then
		/*(-20011,'Estabelecimento da localizao(' ||:new.nr_seq_localizacao|| ') no encontrado ou localizao inexistente.');*/
		wheb_mensagem_pck.exibir_mensagem_abort(263156,'CD_LOCAL=' || :new.nr_seq_localizacao);
	end;
end if;

select	username
into	nm_user_w
from	user_users;

if	(nm_user_w <> 'CORP') then
	select	nvl(max(vl_parametro),'N')
	into	vl_parametro_w
	from	funcao_param_perfil
	where	cd_funcao	= 299
	and	nr_sequencia	= 57;

end if;
/* rotina somente para wheb  ou para quem tem parametro 57 da funo 299 (utiliza sla) */
if	(nm_user_w = 'CORP') or
	(vl_parametro_w = 'S') then
	begin
	select	max(dt_inicio),
		max(dt_termino),
		max(nr_sequencia)
	into	dt_inicio_w,
		dt_termino_w,
		nr_sequencia_w
	from	man_ordem_serv_sla
	where	nr_seq_ordem	= :new.nr_sequencia;

	if	(nr_sequencia_w is null) then
		if	(:new.ie_status_ordem < 3) and
			(verifica_sla_removido(:new.nr_sequencia) = 'N') then
			man_gerar_sla_os(
				cd_estabelecimento_w, :new.nr_sequencia,:new.nm_usuario,
				:new.ie_prioridade, :new.ie_classificacao,
				:new.nr_seq_localizacao, :new.nr_grupo_trabalho, :new.dt_ordem_servico,
				:new.dt_inicio_real, :new.nr_seq_estagio, :new.nr_seq_equipamento, :new.nr_seq_classif, :new.ie_parado);
		end if;
	else
		begin
		if	(dt_inicio_w is null) and
			(:new.dt_inicio_real is not null) then
			update	man_ordem_serv_sla
			set	dt_inicio	= :new.dt_inicio_real
			where	nr_sequencia	= nr_sequencia_w;
		end if;
		if	(dt_termino_w is null) and
			(:new.dt_fim_real is not null) then
			update	man_ordem_serv_sla
			set	dt_termino	= :new.dt_fim_real
			where	nr_sequencia	= nr_sequencia_w;
		end if;


		select	ie_tempo,
			nr_seq_estagio
		into	ie_tempo_w,
			nr_seq_estagio_sla_w
		from	man_ordem_serv_sla	a
		where	a.nr_sequencia	= nr_sequencia_w;

		/*if 	(nr_seq_estagio_sla_w is not null) then
			qt_min_real_os_w		:= 0;

			dt_inicio_ww	:= nvl(:new.dt_inicio_real, :new.dt_ordem_servico);

			select	max(b.cd_estabelecimento)
			into	cd_estabelecimento_ww
			from	man_localizacao	b
			where	b.nr_sequencia	= :new.nr_seq_localizacao;

			select 	max(dt_atualizacao)
			into	dt_estagio_w
			from	man_ordem_serv_estagio
			where	nr_seq_estagio 	= nr_seq_estagio_sla_w
			and	nr_seq_ordem	= :new.nr_sequencia;

			if	(ie_tempo_w = 'COM') then
				select 	Man_Obter_min_Com(cd_estabelecimento_ww, dt_estagio_w, sysdate)
				into	qt_min_real_os_w
				from	dual;
			else
				qt_min_real_os_w	:= (dt_inicio_ww - dt_estagio_w) * 1440;
			end if;
		else*/
		qt_min_real_os_w		:= 0;

		dt_ordem_w	:= :new.dt_ordem_servico;
		dt_inicio_ww	:= nvl(:new.dt_inicio_real, :new.dt_ordem_servico);

		select	max(b.cd_estabelecimento)
		into	cd_estabelecimento_w
		from	man_localizacao	b
		where	b.nr_sequencia	= :new.nr_seq_localizacao;

		if	(ie_tempo_w = 'COM') then
			select 	Man_Obter_min_Com(cd_estabelecimento_w, dt_ordem_w, dt_inicio_ww)
			into	qt_min_real_os_w
			from	dual;
		else
			qt_min_real_os_w	:= (dt_inicio_ww - dt_ordem_w) * 1440;
		end if;

		ie_aguarda_cliente_ww	:= 'N';
		dt_anterior_w		:= dt_inicio_ww;

		OPEN C01;
		LOOP
		FETCH C01 into
			dt_atualizacao_w,
			ie_aguarda_cliente_w;
		exit when c01%notfound;
			begin
			qt_min_w		:= 0;
			if	(ie_aguarda_cliente_ww = 'N') and
				(dt_atualizacao_w > dt_inicio_ww) then
				begin
				if	(ie_tempo_w = 'COM') then
					select 	Man_Obter_min_Com(cd_estabelecimento_w, dt_anterior_w, dt_atualizacao_w)
					into	qt_min_w
					from	dual;
				else
					qt_min_w	:= (dt_atualizacao_w - dt_anterior_w) * 1440;
				end if;
				qt_min_real_os_w	:= qt_min_real_os_w + qt_min_w;
				end;
			end if;
			ie_aguarda_cliente_ww	:= ie_aguarda_cliente_w;
			dt_anterior_w		:= dt_atualizacao_w;
			end;
		END LOOP;
		CLOSE C01;
		--end if;

		--wheb_usuario_pck.set_ie_executar_trigger('N');

		update	man_ordem_serv_sla
		set	qt_min_real_os	= qt_min_real_os_w
		where	nr_sequencia	= nr_sequencia_w;

		--wheb_usuario_pck.set_ie_executar_trigger('S');
		end;
	end if;

	if	(nm_user_w = 'CORP') then
		begin
		begin
		select	nr_seq_gerencia
		into	nr_seq_gerencia_w
		from	grupo_desenvolvimento
		where	nr_sequencia = :new.nr_seq_grupo_des;
		exception
		when others then
			nr_seq_gerencia_w	:=	0;
		end;

		if	(nr_seq_gerencia_w = 60) and
			nvl(man_obter_tipo_sla(:new.nr_sequencia),0) = 1 then
			begin
			select	count(1)
			into	qt_reg_w
			from	man_ordem_servico_exec
			where	nm_usuario_exec = 'pfcaldas'
			and	nr_seq_ordem = :new.nr_sequencia;

			if	(qt_reg_w = 0) then
				insert into man_ordem_servico_exec (
					nr_sequencia,
					nr_seq_ordem,
					dt_atualizacao,
					nm_usuario,
					nm_usuario_exec,
					qt_min_prev,
					dt_recebimento,
					nr_seq_tipo_exec,
					dt_atualizacao_nrec,
					nm_usuario_nrec)
				values(	man_ordem_servico_exec_seq.nextval,
					:new.nr_sequencia,
					sysdate,
					'Tasy',
					'pfcaldas',
					15,
					sysdate,
					1,
					sysdate,
					'Tasy');

				update	man_ordem_servico_exec a
				set	dt_fim_execucao = sysdate
				where	a.nr_seq_ordem = :new.nr_sequencia
				and	a.nm_usuario_exec <> 'pfcaldas'
				and	a.dt_fim_execucao is null
				and	exists (	select	1
						from	grupo_desenvolvimento y,
							usuario_grupo_des x
						where	y.nr_sequencia = x.nr_seq_grupo
						and	y.nr_seq_gerencia = 60
						and	a.nm_usuario_exec = x.nm_usuario_grupo
						and	x.ie_funcao_usuario in ('S','N'));
			end if;
			end;
		end if;
		end;
	end if;
	end;
end if;
-- verificar se  ordem de encerramento de um treinamento. caso a os esteja vinculado a um treinamento dever gerar um registro na tabela de pendncias de avaliao de eficcia os633467
if	(nm_user_w = 'CORP') then
	begin
	select	decode(count(b.nr_seq_agenda),0,'N','S'), -- verifica se a ordem  vinculada a um treinamento
		max(b.nr_seq_agenda)
	into	ie_gerar_aval_efic_w,
		nr_seq_agenda_w
	from	tre_agenda_ordem b
	where	:new.ie_status_ordem = '3'
	and	b.nr_seq_agenda is not null
	and	b.nr_seq_ordem = :new.nr_sequencia;
	if	(nvl(ie_gerar_aval_efic_w,'N') = 'S') then
		begin
		insert	into	man_aval_eficacia_tre (
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			nr_seq_ordem_tre,
			nr_seq_agenda,
			nr_seq_ordem,
			ie_gerado_ordem)
		values	(man_aval_eficacia_tre_seq.nextval,
			sysdate,
			:new.nm_usuario,
			:new.nr_sequencia,
			nr_seq_agenda_w,
			null,
			'N');
		end;
	end if;
	end;
end if;

if	(obter_valor_param_usuario(299,528,obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento) = 'S') then
	begin

	--buscar o  setor
	select	max(obter_setor_usuario_pf(:new.CD_PESSOA_SOLICITANTE))
	into	cd_setor_usuario_w
	from	dual;

	--buscar o  responsavel pelo setor
	select	max(b.nm_usuario)
	into 	nm_usuario_resp_w
	from    setor_atendimento a,
		usuario b
	where	a.cd_pessoa_resp = b.cd_pessoa_fisica
	and	a.cd_setor_atendimento = cd_setor_usuario_w;

	--verificao se j existe o usurio responsavel do setor como executor

	SELECT	COUNT(*)
	INTO	qtd_registro_usuario_setor_w
	FROM 	man_ordem_servico_exec
	WHERE	nr_seq_ordem = :NEW.nr_sequencia
	AND 	nm_usuario_exec = nm_usuario_resp_w;

	if	(qtd_registro_usuario_setor_w = 0) and
		(nm_usuario_resp_w is not null) then
		begin

		insert into man_ordem_servico_exec (
				nr_sequencia,
				nr_seq_ordem,
				dt_atualizacao,
				nm_usuario,
				nm_usuario_exec,
				qt_min_prev,
				dt_recebimento,
				nr_seq_tipo_exec,
				dt_atualizacao_nrec,
				nm_usuario_nrec)
			values(	man_ordem_servico_exec_seq.nextval,
				:new.nr_sequencia,
				sysdate,
				'Tasy',
				nm_usuario_resp_w,
				15,
				sysdate,
				null,
				sysdate,
				'Tasy');
		end;
		end if;
	end;
end if;

if	(nm_user_w = 'CORP') and (:new.cd_funcao is not null) and (:new.nr_seq_localizacao is not null) and INSERTING then
begin
	man_enviar_ci_complaint(:new.nr_sequencia, :new.nr_seq_localizacao, :new.cd_funcao);
	Exception
	when others then
		goto final;
end;
end if;

<<final>>
qt_reg_w	:= 0;
end;
/
ALTER TRIGGER "TASY"."MAN_ORDEM_SERVICO_AFTER" ENABLE;
